# 實驗檢討：滑動窗口變更後

> **建立日期**：2026-01-13
> **觸發原因**：採用滑動窗口 + GroupKFold 後，需重新審視所有實驗

---

## 資料變更摘要

| 項目 | 舊版 | 新版 |
|------|------|------|
| **資料格式** | 固定窗口 (T1,T2→T3) | 滑動窗口 (Ti,Ti+1→Ti+2) |
| **樣本數** | 6,056 | 13,514 |
| **CV 策略** | StratifiedKFold | StratifiedGroupKFold |
| **資料洩漏** | 可能有（同患者跨 fold） | 無（GroupKFold 保證） |

---

## 實驗狀態審查

### 不需重做 ✅

| Notebook | 原因 |
|----------|------|
| 01_EDA | 探索性分析，不影響結論 |
| 02_DataPreprocessing | 資料預處理流程參考用 |

### 結論仍有效，但數據需更新 🔄

| Notebook | 說明 | 優先度 |
|----------|------|--------|
| **09_Delta_Ablation** | Δ 特徵效果結論不變，但 AUC 數值會變 | 中 |
| **10_ClassWeight_Ablation** | class_weight 效果結論不變 | 低 |
| **08_SHAP_Analysis** | 特徵重要性排序可能變化 | 高 |

### 需要重做 🔴

| Notebook | 原因 | 優先度 |
|----------|------|--------|
| **13_5FoldCV** | → 已由 **17** 取代 | ✅ 已完成 |
| **03-07 模型訓練** | 基於舊資料，結果不可靠 | 低（17 已涵蓋） |
| **14_Checkup_Frequency** | 健檢次數實驗需重新設計 | 中 |

### PySR 系列（待定）❓

| Notebook | 說明 |
|----------|------|
| 11, 12, 15, 16, 18 | PySR 實驗，滑動窗口後可能需重跑 |

**問題**：PySR 的符號回歸公式是否需要用新資料重新產出？

---

## 待執行新實驗

### 1. 共病效應分析 (優先)

**目的**：了解三高之間的基礎關聯，為 MTL 分析提供背景

**分析內容**：
- 三高同時出現的比例（共病率）
- Odds Ratio / 相關係數
- 已有一種三高 → 另一種的風險倍數
- 疾病發生順序模式（若資料支援）

**為什麼先做**：
- MTL 效能提升可能來自疾病本身的關聯
- 需要先了解基礎關聯，才能正確解讀 MTL 結果

### 2. MTL vs STL 比較

**目的**：驗證多任務學習是否優於單任務學習

**實驗設計**：
- STL：三個獨立模型（目前做法）
- MTL：共享底層 + 任務專屬輸出層

**評估**：
- AUC / PR-AUC 比較
- 訓練效率（時間、參數量）
- 泛化能力

### 3. SHAP 重做（用滑動窗口資料）

**原因**：特徵重要性可能因資料變更而改變

### 4. 外部驗證 (Synthea)

**狀態**：待整理 Synthea 資料格式

---

## 論文影響

### 需更新的章節

1. **方法論**：加入滑動窗口說明、GroupKFold
2. **實驗結果**：所有 AUC 數值需用新結果
3. **比較表**：與其他論文比較的數據

### 核心賣點是否改變？

| 賣點 | 影響 |
|------|------|
| Δ 特徵 | ✅ 不變，仍是創新點 |
| 三高同時預測 | ✅ 不變 |
| 可解釋性 (SHAP + PySR) | ⚠️ 需重做確認 |
| 滑動窗口 | ✅ **新增賣點**（參考 Taiwan MJ 2024） |

---

## 建議執行順序

```
1. 共病效應分析（快速，統計為主）
   ↓
2. MTL vs STL 實驗
   ↓
3. SHAP 重做（滑動窗口資料）
   ↓
4. Delta Ablation 更新數據（可選）
   ↓
5. 外部驗證 Synthea
   ↓
6. PySR 重做（若時間允許）
```

---

## 相關文件

- [17_SlidingWindow_5FoldCV.ipynb](../../notebooks/experiments/17_SlidingWindow_5FoldCV.ipynb) - 新基準
- [Experiment_Hypothesis_List.md](Experiment_Hypothesis_List.md) - 實驗假說清單
- [第二章_問題定義.md](../01_thesis/chapters/第二章_問題定義.md) - 更新後的問題定義
