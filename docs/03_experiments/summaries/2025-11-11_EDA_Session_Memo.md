# 實驗記錄：首次 EDA 分析

**日期**：2025-11-11
**任務**：中國東南部資料集探索性分析
**狀態**：✅ 成功執行

---

## 📋 今日完成項目

### 1. ✅ 環境建置
- 使用 VS Code Jupyter 擴充功能
- 選擇 Python 環境：ai (Python 3.7.16)
- 成功執行第一個 Notebook

### 2. ✅ 資料載入
- 檔案：`data/raw/SUA_CVDs_risk_factors.csv`
- 成功載入 25,744 筆記錄
- 確認資料完整度：無缺失值

### 3. ✅ 變數編碼確認
- 查詢 Dryad 資料集官方文檔
- 確認三高目標變數編碼：
  - **1 = No（無病、正常）**
  - **2 = Yes（有病）**

---

## 🔍 關鍵發現

### 資料集特性

1. **縱向資料結構** ⭐
   - 每位參與者至少有 3 次健康檢查
   - 總參與人數：6,119 人
   - 總記錄數：25,744 筆
   - 平均每人：~4.2 次檢查

2. **完整血液檢驗指標**
   - 包含 11 項關鍵指標
   - 涵蓋代謝、血脂、肝腎功能

3. **資料品質**
   - ✅ 無缺失值
   - ✅ 資料來源明確（DOI: 10.5061/dryad.z08kprrk1）

### 初步觀察（從 Notebook 輸出）

**資料欄位**（部分）：
- ID, sex, Age, BMI
- SBP, DBP, FBG
- TC, Cr, GFR, UA
- Times（檢查次數）
- hypertension, hyperglycemia, dyslipidemia（目標變數）

**前5筆資料範例**：
```
   ID  sex  Age    BMI   SBP   DBP   FBG   TC   Cr   GFR    UA  Times  hypertension  hyperglycemia  dyslipidemia
0   1    2   79  24.35   132    83  6.20  4.65  54  116.182  284      1             1              1              1
1   1    2   81  25.24   136    85  6.09  4.97  95   57.605  208      2             1              1              1
2   1    2   83  23.43   120    86  6.16  4.92  66   89.899  230      3             1              1              1
```

---

## 💡 重要洞察

### 1. 資料編碼確認
- 第 0 筆資料：三高都是 `1`（表示無病）
- 第 1 筆資料：hypertension=`2`（有高血壓），其他=`1`
- 符合官方說明：1=否, 2=是

### 2. Times 欄位
- 第 0 筆：Times=1（第一次檢查）
- 第 1 筆：Times=2（第二次檢查）
- 第 2 筆：Times=3（第三次檢查）
- 這三筆記錄可能都屬於同一位參與者（ID=1）

### 3. 與研究設計的匹配度
- ✅ **完美匹配**！
- 可以用 T1 和 T2 預測 T3
- 可以計算 Δ 變化量（T2 - T1）

---

## 📊 下一步分析重點

### 待確認項目

1. **資料結構驗證**
   ```python
   # 確認每個 ID 有多少次記錄
   df.groupby('ID')['Times'].count()

   # 確認 Times 的分佈
   df['Times'].value_counts().sort_index()
   ```

2. **三高盛行率**
   ```python
   # 計算每種疾病的比例
   for col in ['hypertension', 'hyperglycemia', 'dyslipidemia']:
       print(f"{col}: {(df[col] == 2).sum() / len(df) * 100:.2f}%")
   ```

3. **血液檢驗指標分佈**
   - 繪製 11 項指標的直方圖
   - 檢查是否有異常值

4. **相關性分析**
   - 血液指標之間的相關性
   - 特徵與目標變數的相關性

---

## 🎯 實驗進度追蹤

### 已完成 ✅
- [x] Anaconda 環境建置
- [x] VS Code Jupyter 擴充安裝
- [x] 資料載入成功
- [x] 變數編碼確認
- [x] 初步資料檢視

### 進行中 🔄
- [ ] 完整 EDA 分析（執行所有 Notebook Cell）
- [ ] 資料結構驗證
- [ ] 視覺化圖表產出

### 待進行 📋
- [ ] 資料重組（長格式 → 寬格式）
- [ ] 特徵工程（Δ 變化量）
- [ ] 資料分割（Train/Val/Test）
- [ ] 第一個模型訓練

---

## 🛠️ 技術筆記

### Jupyter 環境
- **工具**：VS Code Jupyter 擴充
- **優點**：
  - 不需要開瀏覽器
  - 支援單步執行
  - 變數檢視器
  - 整合在 VS Code 中

### Python 環境
- **環境名稱**：ai (Python 3.7.16)
- **主要套件**：pandas, numpy, matplotlib, seaborn

### Notebook 位置
- `notebooks/experiments/01_EDA_Chinese_Dataset.ipynb`

---

## 📈 視覺化產出（預期）

執行完整 Notebook 後將產生：

1. **blood_test_distributions.png**
   - 11 項血液檢驗指標的分佈圖

2. **correlation_matrix.png**
   - 血液指標相關性熱力圖

3. **eda_summary.json**
   - 分析結果摘要（JSON 格式）

---

## 💭 研究者筆記

### 發現與想法

1. **資料品質優良**
   - 無缺失值是一大優勢
   - 縱向資料結構完整

2. **與 Dual Framework 2025 的對比**
   - 該論文使用 δ-FPG（血糖變化量）
   - 我們可以計算所有 11 項指標的 Δ 值
   - 更全面的變化量特徵

3. **與 Lin et al. 2024 的對比**
   - Lin 只用傳統統計（Logistic Regression）
   - Lin 沒有報告預測效能（AUC, Accuracy）
   - 我們的創新點：使用 ML + 完整效能評估

### 潛在挑戰

1. **資料重組**
   - 需要將長格式資料轉為寬格式
   - 每個 ID 的 T1, T2, T3 要對齊

2. **類別不平衡**
   - 需要確認三高的比例
   - 可能需要 SMOTE 或其他平衡技術

3. **特徵選擇**
   - 11 項 × 2 時間點 × 變化量 = 33 個特徵
   - 需要考慮特徵重要性分析

---

## 🔗 相關文檔

### 資料集文檔
- [SUA_Dataset_Documentation.md](../datasets/SUA_Dataset_Documentation.md) - 完整資料集說明

### 實驗 Notebook
- [01_EDA_Chinese_Dataset.ipynb](../../notebooks/experiments/01_EDA_Chinese_Dataset.ipynb)

### 研究計畫
- [Meeting_17_Preparation_Plan.md](../meeting_notes/Meeting_17_Preparation_Plan.md)

---

## ⏰ 時間記錄

- **開始時間**：2025-11-11 下午
- **完成項目**：環境建置、資料載入、變數確認
- **耗時**：約 1-2 小時
- **下次計畫**：完成完整 EDA 分析

---

## ✅ 今日成就

1. ✅ 成功建置實驗環境
2. ✅ 第一次執行 Jupyter Notebook
3. ✅ 確認資料集變數定義
4. ✅ 驗證資料品質（無缺失值）
5. ✅ 建立完整文檔記錄

---

## 🔬 未來實驗想法

### 時間點選擇策略比較

**背景**：目前採用「前3次檢查」（T1, T2, T3）作為標準方案

**待驗證的替代方案**：
1. **方案 A（目前）**：取前3次（T1, T2, T3）
   - 優點：觀察「健康→生病」的完整過程，符合早期預測目標
   - 適用：預防醫學、風險預測

2. **方案 B（未來實驗）**：取後3次
   - 4次檢查的人：T2, T3, T4
   - 5次檢查的人：T3, T4, T5
   - 優點：資料更新鮮，可能更接近發病時間點
   - 適用：疾病進展研究、已確診病患管理

3. **方案 C（進階分析）**：分層比較
   - 將「只有3次」vs「有4次以上」的人分開分析
   - 檢驗：長期追蹤的人是否風險更高？
   - Subgroup analysis

**實驗價值**：
- 比較不同時間點選擇對模型效能的影響
- 探討「早期預測」vs「疾病進展預測」的差異
- 為臨床應用提供更全面的視角

**優先級**：低（等基礎模型完成後再考慮）

---

**記錄者**：紀伯喬
**狀態**：進行中
**下次目標**：完成資料前處理（02_DataPreprocessing.ipynb）

---

## 📌 快速回顧

**Q: 三高變數的 1 和 2 代表什麼？**
**A**: 1=否（無病）, 2=是（有病）

**Q: 資料集有多少筆記錄？**
**A**: 25,744 筆（6,119 人 × 平均 4.2 次檢查）

**Q: 資料是否為縱向資料？**
**A**: ✅ 是！每人至少有 3 次檢查記錄

**Q: 資料品質如何？**
**A**: ✅ 優良，無缺失值
