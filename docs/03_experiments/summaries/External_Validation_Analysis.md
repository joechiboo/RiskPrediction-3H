# Synthea 外部驗證分析

> **建立日期**：2026-01-13
> **狀態**：分析完成
> **結論**：僅高血壓可進行有限度的外部驗證

---

## 1. 外部驗證目的

**核心問題**：不同的 dataset 執行相同的實驗，能不能得到相同的結論？

**驗證資料**：Synthea 合成醫療資料
- 來源：https://synthea.mitre.org/
- 總記錄：14,466 筆
- 患者數：1,158 人

---

## 2. 資料品質問題

### 2.1 缺失值概況

| 特徵 | Synthea 缺失率 | SUA 缺失率 | 影響疾病 |
|------|---------------|------------|----------|
| FBG（空腹血糖） | **69.0%** | 0% | 高血糖 |
| TC（總膽固醇） | **72.2%** | 0% | 高血脂 |
| UA（尿酸） | **100%** | 0% | - |
| BMI | 20.0% | 0% | 全部 |
| SBP/DBP | 0% | 0% | 高血壓 |

### 2.2 檢測偏差分析

Synthea 的資料生成邏輯導致嚴重的**檢測偏差 (Testing Bias)**：

#### FBG 記錄 vs 高血糖標籤

| 分類 | 有 FBG 記錄 | 沒有 FBG 記錄 | 總計 |
|------|------------|--------------|------|
| 高血糖=1 (正常) | **25** | 8,916 | 8,941 |
| 高血糖=2 (異常) | **4,465** | 1,060 | 5,525 |
| 總計 | 4,490 | 9,976 | 14,466 |

**發現**：Synthea 只對糖尿病/高血糖患者記錄 FBG，正常人幾乎沒有 FBG 記錄。

#### TC 記錄 vs 高血脂標籤

| 分類 | 有 TC | 沒有 TC |
|------|-------|---------|
| 高血脂比例 | **25.2%** | 9.8% |

**發現**：有 TC 記錄的人高血脂比例是沒有記錄的 2.5 倍，存在中度偏差。

---

## 3. 各疾病驗證可行性

### 3.1 高血糖 - ❌ 不可行

**原因**：極端選擇偏差

| 指標 | 數值 |
|------|------|
| 可用記錄 | 4,490 (31%) |
| 陽性比例 | **99.4%** |
| 陰性樣本 | 僅 25 筆 |

**結論**：有 FBG 的記錄中 99.4% 是高血糖患者，無法進行二元分類。這不是缺失值問題，而是 Synthea 資料生成邏輯本身的限制。

---

### 3.2 高血脂 - ⚠️ 有限度可行

**資料概況**：

| 指標 | 數值 |
|------|------|
| 可用記錄 | 4,018 (28%) |
| 有 ≥2 次記錄的患者 | 682 |
| 陽性比例 | 25.2% |
| SUA 陽性比例 | 7.9% |

**問題**：
- 陽性比例 25.2% 遠高於 SUA 的 7.9%
- 存在中度檢測偏差
- 樣本量較小

**結論**：技術上可行，但結果可比性存疑。

---

### 3.3 高血壓 - ✅ 可行（有限度）

**資料概況**：

| 指標 | Synthea | SUA |
|------|---------|-----|
| 可用記錄 | 11,571 (80%) | 13,514 |
| 有 ≥2 次記錄的患者 | 1,117 | 6,056 |
| 陽性比例 | 31.7% | 19.3% |

**特徵分佈比較**：

| 特徵 | Synthea | SUA | 差異 |
|------|---------|-----|------|
| 平均年齡 | 43.7 歲 | 68.1 歲 | **-24.4 歲** |
| 年齡 < 40 歲 | 42.4% | 0% | Synthea 含年輕人 |
| 年齡 ≥ 65 歲 | 22.7% | 62.7% | SUA 以老年為主 |
| BMI | 26.1 | 23.4 | +2.7 |
| SBP | 123.9 | 125.5 | -1.6 |
| DBP | 82.6 | 75.3 | +7.3 |

**主要問題**：年齡分佈差異極大（平均差 25 歲）

---

## 4. 高血壓外部驗證實驗

### 4.1 實驗設計

- **訓練集**：SUA 全部資料（13,514 樣本）
- **測試集**：Synthea 完整記錄（11,571 樣本）
- **特徵**：Age, BMI, SBP, DBP（4 個共同特徵）
- **模型**：LR, RF

### 4.2 實驗結果

| 模型 | SUA 5-Fold CV | Synthea 全部 | Synthea ≥40歲 |
|------|---------------|--------------|---------------|
| LR | 0.698 ± 0.017 | 0.751 | 0.636 |
| RF | 0.648 ± 0.009 | 0.621 | 0.594 |

### 4.3 結果分析

1. **LR 在全部 Synthea 上 AUC=0.751**
   - 看似比 SUA 更好，但這是假象
   - Synthea 有 42% 是年輕人，年輕人本來就不易有高血壓
   - 模型容易「猜對」

2. **篩選 ≥40 歲後，AUC 下降到 0.636**
   - 這是較公平的比較
   - 比 SUA (0.698) 低約 6%
   - 說明模型「可遷移」但效能有下降

3. **RF 過擬合明顯**
   - 訓練集 AUC 接近 1.0（過度記憶）
   - 外部驗證表現較差

### 4.4 結論

高血壓外部驗證**技術上可行**，但：
- 效能下降約 6-9%（AUC 0.70 → 0.64）
- 原因是資料分佈不同（年齡、BMI、盛行率）
- 這是「預期中的下降」，符合 domain shift 理論

---

## 5. 總結

### 5.1 外部驗證可行性總表

| 疾病 | 可行性 | 原因 |
|------|--------|------|
| **高血壓** | ✅ 可行（有限度） | 資料完整，但年齡分佈差異大 |
| **高血脂** | ⚠️ 有限度 | 中度檢測偏差，陽性比例偏高 |
| **高血糖** | ❌ 不可行 | 極端選擇偏差（99.4% 陽性） |

### 5.2 論文建議

#### 若選擇納入高血壓外部驗證

> **Results 段落**：
>
> 為評估模型的泛化能力，我們使用 Synthea 合成醫療資料進行外部驗證。由於 Synthea 資料中空腹血糖（FBG）和總膽固醇（TC）缺失率高達 70%，且存在嚴重選擇偏差，僅針對高血壓進行驗證。
>
> 在 Synthea 資料上，Logistic Regression 模型達到 AUC 0.636（限 ≥40 歲樣本），相較於內部驗證的 0.698 下降約 9%。此效能下降符合預期，主要原因是兩資料集的年齡分佈差異顯著（Synthea 平均 43.7 歲 vs SUA 68.1 歲）。

#### 若選擇不納入外部驗證

> **Discussion - 研究限制段落**：
>
> 本研究嘗試使用 Synthea 合成醫療資料進行外部驗證。然而，Synthea 資料存在以下限制：(1) 關鍵特徵（FBG、TC）缺失率高達 70%；(2) 有 FBG 記錄的樣本中 99% 為高血糖患者，存在嚴重選擇偏差；(3) 年齡分佈與本研究資料差異顯著。因此，無法進行有效的外部驗證。未來研究可考慮申請實際醫療資料（如 MJ Health）進行驗證。

---

## 6. 相關檔案

### 資料檔案
- `data/01_primary/Synthea/Synthea_SUA_format.csv`

### 參考文件
- [external_data_sources.md](../../01_data/external_data_sources.md) - 外部資料來源說明
- [Synthea_Dataset_Summary.md](../../06_datasets/Synthea/Synthea_Dataset_Summary.md) - Synthea 資料集摘要
