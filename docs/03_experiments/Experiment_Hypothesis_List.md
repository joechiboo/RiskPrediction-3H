# 實驗與假說清單

> **建立日期**：2026-01-10
> **狀態**：持續更新

---

## 已完成實驗

### 1. ✅ 5-Fold CV 模型比較
- **狀態**：已完成 (2026-01-07)
- **結果**：LR 和 RF 表現最佳
- **輸出**：[13_5FoldCV_Model_Comparison.ipynb](../../notebooks/experiments/13_5FoldCV_Model_Comparison.ipynb)

### 2. ✅ Delta 特徵消融實驗
- **狀態**：已完成
- **結果**：Δ 特徵顯著提升預測效能
- **輸出**：[Delta消融實驗分析.md](summaries/Delta消融實驗分析.md)

### 3. ✅ Class Weight 消融實驗
- **狀態**：已完成
- **結果**：class_weight='balanced' 有效
- **輸出**：[ClassWeight消融實驗分析.md](summaries/ClassWeight消融實驗分析.md)

### 4. ✅ 健檢次數與預測準確度實驗 ⭐
- **狀態**：已完成 (2026-01-10)
- **假說**：健檢次數越多，預測準確度越高（參考 Taiwan MJ 2024）
- **實驗設計**：固定預測 T5，改變輸入健檢次數（公平比較）

| 實驗組 | 輸入特徵 | 特徵數 | 預測目標 |
|-------|---------|--------|----------|
| 1次 | T4 | 10 | T5 |
| 2次 | T3, T4, Δ3 | 26 | T5 |
| 3次 | T2~T4, Δ2~Δ3 | 42 | T5 |
| 4次 | T1~T4, Δ1~Δ3 | 58 | T5 |

- **結果**：

| 疾病 | 1次 | 2次 | 3次 | 4次 | 增量 |
|------|-----|-----|-----|-----|------|
| **高血壓** | 0.666 | 0.679 | 0.676 | **0.835** | **+0.169** ⭐ |
| 高血糖 | 0.931 | 0.940 | 0.942 | 0.945 | +0.014 |
| 高血脂 | 0.867 | 0.879 | 0.883 | 0.882 | +0.015 |

- **結論**：
  - ✅ **假說成立**：健檢次數越多，預測越準
  - ⭐ **高血壓獲益最大**：4次比1次 AUC 提升 +17%
  - 💡 T1 早期基線對高血壓預測特別重要（3次→4次跳躍 +0.159）
  - 高血糖/高血脂基線已高，邊際效益較小

- **輸出**：[14_Checkup_Frequency_Experiment.ipynb](../../notebooks/experiments/14_Checkup_Frequency_Experiment.ipynb)

---

## 待執行實驗

### 5. 📋 PySR 參數調整實驗（Grid Search 風格）

**假說**：透過系統性參數調整，可以找到讓 PySR 產生穩定且高效能公式的最佳參數組合。

**背景**：
- 目前 PySR 結果不穩定（有時 AUC=0.5，常數解）
- 參考 JMIR 2025 論文的 Grid Search 做法

**參數候選值**：

| 參數 | 說明 | 候選值 |
|------|------|--------|
| niterations | 遺傳演算法迭代次數 | [100, 200, 400] |
| populations | 族群數量 | [10, 15, 20] |
| maxsize | 公式最大複雜度 | [15, 25, 35] |
| timeout | 超時秒數 | [600, 1200, 1800] |

**評估指標**：
- AUC（主要）
- 公式複雜度（越簡單越好）
- 執行時間

**預期結果**：
- 找到一組「最佳參數」讓 PySR AUC > 0.75
- 公式簡潔可解釋
- 執行時間合理（< 30 分鐘/疾病）

---

### 6. 📋 評估指標選擇實驗

**假說**：對於類別不平衡的資料，PR-AUC 比 ROC-AUC 更能反映模型對少數類的預測能力。

**背景**：
- 參考 JMIR 2025 論文同時報告 ROC-AUC 和 PR-AUC
- 我們的類別不平衡嚴重（Hyperglycemia 1:17, Dyslipidemia 1:16）

**待加入的評估指標**：

| 指標 | 說明 | 適用情境 |
|------|------|----------|
| **ROC-AUC** | 目前主要指標 | 通用 |
| **PR-AUC** | Precision-Recall AUC | 類別極度不平衡 |
| **Calibration curves** | 校準曲線 | 評估預測機率準確性 |
| **DCA** | Decision Curve Analysis | 評估臨床效用 |
| **DeLong test** | AUC 統計比較 | 模型間差異顯著性檢定 |

**實驗設計**：
- 在現有 5-fold CV 框架中加入 PR-AUC
- 比較 ROC-AUC 和 PR-AUC 的排名是否一致
- 特別關注 Hyperglycemia 和 Dyslipidemia

---

### 7. 📋 MTL vs STL 完整比較

**假說**：多任務學習（MTL）透過共享表示，可以提升整體預測效能。

**實驗設計**：
- STL：三個獨立模型分別預測三高
- MTL：單一模型同時預測三高
- 比較 AUC、訓練時間、泛化能力

---

### 8. 📋 外部驗證（Synthea）

**假說**：模型在外部合成資料上仍能維持預測效能，展示泛化能力。

**資料說明**：
- **主要資料**：SUA（中國浙江，真實健檢資料）
- **外部驗證**：Synthea（美國合成病患資料）

**參考 JMIR 2025 做法**：
- 主要隊列 AUC: 0.819
- 外部驗證 AUC: 0.807
- 下降幅度: 1.2%

**我們的報告格式**：
- SUA (主要) AUC: X.XXX
- Synthea (外部) AUC: X.XXX
- 下降幅度: X.X%

**注意事項**：
- Synthea 為合成資料，需轉換為 SUA 相容格式
- 可能存在特徵分佈差異

---

## Future Work 延伸實驗

### 9. 🔮 健檢間隔實驗（稀疏化比較）

**假說**：較長的健檢間隔是否仍能維持預測效能？

**SUA 資料限制**：
- 原始間隔約 2 年（90%）或 1 年（10%）
- 無法模擬「更密集」的健檢（如 1 年驗一次）
- 只能做「稀疏化」比較

**可行的模擬方式**：

| 模擬間隔 | 方式 | 說明 |
|---------|------|------|
| ~2 年 | T1, T2 → T3 | 目前做法（baseline） |
| ~4 年 | T1, T3 → T5 | 跳過 T2, T4 |
| ~6 年 | T1, T4 → T7 | 跳過更多時間點 |

**研究問題**：
- 如果健檢資源有限，較長間隔是否足夠？
- 跳過中間時間點對 Δ 特徵的影響？

**臨床意義**：為健檢頻率政策提供建議

**替代方案**：使用 **Synthea**（間隔約 1 年）做 1年 vs 2年 vs 3年 比較

---

### 10. ❌ 健檢頻率實驗（一年驗兩次）— 無法執行

**假說**：密集健檢（每半年一次）是否有額外預測價值？

**無法執行原因**：
- SUA 資料無明確日期欄位，只有「第幾次健檢」
- 原始間隔已是 1-2 年，無法模擬更密集的健檢
- 需要有時間戳的高頻健檢資料才能驗證

**未來可能性**：
- 若取得有明確日期的健檢資料（如電子病歷）可執行
- 或使用 Synthea 自訂生成高頻資料

---

## 評估指標總覽

### 目前使用

| 指標 | 類型 | 說明 |
|------|------|------|
| AUC-ROC | 區分能力 | 主要指標 |
| Sensitivity | 分類 | 召回率 |
| Specificity | 分類 | 特異度 |
| F1-Score | 分類 | 精確率與召回率的調和平均 |
| Balanced Accuracy | 分類 | 平衡準確率 |

### 待加入

| 指標 | 類型 | 說明 | 優先度 |
|------|------|------|--------|
| **PR-AUC** | 區分能力 | 適合不平衡資料 | 高 |
| **Calibration curves** | 校準能力 | 預測機率準確性 | 中 |
| **DCA** | 臨床效用 | 決策曲線分析 | 中 |
| **DeLong test** | 統計 | AUC 差異檢定 | 中 |
| **NPV/PPV** | 分類 | 陰性/陽性預測值 | 低 |

---

## 相關文件

- [Meeting_19_Notes.md](../04_meetings/Meeting_19_Notes.md)
- [Paper_China_Prediabetes_Diabetes_2025.md](../02_literature/summaries/Paper_China_Prediabetes_Diabetes_2025.md)
- [13_5FoldCV_Model_Comparison.ipynb](../../notebooks/experiments/13_5FoldCV_Model_Comparison.ipynb)
