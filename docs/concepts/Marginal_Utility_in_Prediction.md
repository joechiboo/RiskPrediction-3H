# 邊際效應遞減（Diminishing Marginal Returns）在預測模型中的應用

## 概念定義

**邊際效應遞減**：隨著投入資源的增加，額外投入帶來的收益增量會逐漸減少，最終趨近於零。

在疾病預測的情境下：
- **投入**：使用的歷史檢驗記錄次數（2次、3次、4次...）
- **收益**：預測準確度（AUC、F1-Score 等）
- **遞減現象**：從 2 次增加到 3 次，準確度可能提升 5%；但從 5 次增加到 6 次，可能只提升 0.5%

---

## 研究問題

### 核心問題
**使用多少次歷史檢驗記錄，能達到最佳的「性能-成本」平衡點？**

### 具體實驗設計

#### 情境設定
我們的 Synthea 資料集：
- 1,155 位病患有 3+ 次記錄
- 平均每位病患 12.49 次記錄
- 最多達 198 次記錄

#### 實驗組
| 組別 | 使用記錄數 | 預測目標 | 樣本數（估計） |
|------|-----------|---------|---------------|
| Group 1 | 2 次 (T₁, T₂) | 預測 T₃ | ~1,155 |
| Group 2 | 3 次 (T₁, T₂, T₃) | 預測 T₄ | ~1,100 |
| Group 3 | 4 次 (T₁, T₂, T₃, T₄) | 預測 T₅ | ~900 |
| Group 4 | 5 次 | 預測 T₆ | ~700 |
| Group 5 | 6 次 | 預測 T₇ | ~500 |
| ... | ... | ... | ... |

---

## 預期結果圖示

### 1. 準確度 vs. 記錄次數

```
AUC-ROC
  0.90 |                    ___________
       |                ___/
  0.85 |           ____/
       |       ___/
  0.80 |   ___/
       | _/
  0.75 |/
       +----------------------------------
         2    3    4    5    6    7   次數

         ↑         ↑            ↑
       快速成長   成長趨緩    幾乎平穩
```

### 2. 邊際收益（Marginal Gain）

```
△AUC
 0.05 | █
      | █
 0.04 | █
      | ██
 0.03 | ██
      | ███
 0.02 | ███
      | ████
 0.01 | █████
      | ██████
 0.00 | ███████
      +----------------------------------
         2→3  3→4  4→5  5→6  6→7

         ↑                        ↑
      邊際收益高              邊際收益低
```

---

## 實驗方法

### 特徵工程策略

#### Group 1: 使用 2 次記錄 (T₁, T₂ → T₃)
```python
特徵：
- T₁: SBP₁, DBP₁, BMI₁, FBG₁, TC₁, ...
- T₂: SBP₂, DBP₂, BMI₂, FBG₂, TC₂, ...
- Δ(T₂-T₁): ΔSBP, ΔDBP, ΔBMI, ΔFBG, ΔTC, ...
- 時間間隔: days_T1_T2, days_T2_T3

預測目標: T₃ 的三高狀態
```

#### Group 2: 使用 3 次記錄 (T₁, T₂, T₃ → T₄)
```python
特徵：
- T₁, T₂, T₃ 的各項指標
- Δ(T₂-T₁), Δ(T₃-T₂)
- 額外特徵：
  - 線性趨勢 (slope)：SBP 的變化斜率
  - 變異性 (variance)：BMI 的波動程度
- 時間間隔: days_T1_T2, days_T2_T3, days_T3_T4

預測目標: T₄ 的三高狀態
```

#### Group 3+: 使用 4+ 次記錄
```python
額外特徵：
- 統計量：mean, std, min, max (跨多次記錄)
- 趨勢：線性/非線性擬合
- 週期性：是否有季節性變化
```

### 評估方法

**固定模型**：使用同一種模型（如 XGBoost）
**評估指標**：
- AUC-ROC
- F1-Score
- Recall

**比較方式**：
```python
results = []
for n_records in [2, 3, 4, 5, 6, 7, ...]:
    # 篩選有 n+1 次記錄的病患
    patients = filter_patients(min_records=n_records+1)

    # 建構特徵
    X = build_features(patients, n_records)
    y = get_labels(patients, target_time=n_records+1)

    # 訓練與評估
    auc = train_and_evaluate(X, y)
    results.append({'n_records': n_records, 'auc': auc})

# 計算邊際收益
marginal_gain = [results[i]['auc'] - results[i-1]['auc']
                 for i in range(1, len(results))]
```

---

## 研究意義

### 1. 臨床實用性
- **成本考量**：每增加一次檢驗，需額外的時間、金錢、人力
- **最佳化建議**：找到「性能-成本」的平衡點
  - 若 2 次記錄 AUC=0.80，3 次 AUC=0.85，4 次 AUC=0.86
  - 結論：3 次記錄是最佳選擇（邊際收益明顯，成本可接受）

### 2. 理論貢獻
- **資訊飽和點（Information Saturation）**：證明超過某個次數後，歷史資料對預測的貢獻有限
- **時間序列深度（Temporal Depth）**：探討縱向資料的最佳時間窗口

### 3. 與文獻對比
| 研究 | 使用記錄數 | AUC | 備註 |
|------|-----------|-----|------|
| Liu et al. (2024) | 2 次 (Baseline + Follow-up) | 0.93 | 10 年追蹤 |
| 本研究 | 2-7+ 次（實驗比較） | TBD | 探討邊際效應 |

**創新點**：
- Liu 等人固定使用 2 次記錄
- 本研究系統性比較不同記錄數的影響

---

## 可能的發現

### 情境 A：早期飽和
```
2次 → 3次：AUC +0.05
3次 → 4次：AUC +0.01
4次+ → ... ：AUC +0.00
```
**結論**：3 次記錄已達資訊飽和，建議臨床使用 3 次檢驗即可

### 情境 B：持續改善
```
2次 → 3次：AUC +0.03
3次 → 4次：AUC +0.03
4次 → 5次：AUC +0.02
5次+ → ... ：仍持續增長
```
**結論**：歷史資料越多越好，但需權衡成本

### 情境 C：過擬合風險
```
2次 → 3次：Training AUC +0.05, Test AUC +0.04
3次 → 4次：Training AUC +0.05, Test AUC +0.01  ← 差距擴大
4次+ → ... ：Test AUC 開始下降
```
**結論**：使用過多歷史記錄可能導致過擬合，需謹慎處理

---

## 實驗挑戰

### 1. 樣本數減少
- 使用 2 次記錄：~1,155 位病患
- 使用 5 次記錄：~700 位病患
- 使用 10 次記錄：可能 <200 位病患

**解決方案**：
- 報告不同記錄數的樣本量
- 使用 Bootstrap 評估統計顯著性
- 設定最低樣本數門檻（如 N > 300）

### 2. 時間間隔不一致
- 病患 A：每年檢查（間隔固定）
- 病患 B：不規則檢查（間隔 1 年、3 年、半年...）

**解決方案**：
- 加入時間間隔作為特徵
- 分層分析（固定間隔 vs. 不固定間隔）
- 標準化時間窗口（如限制每次間隔 0.5-2 年）

### 3. 特徵維度爆炸
- 2 次記錄：~20 個特徵
- 5 次記錄：~50 個特徵
- 10 次記錄：~100 個特徵

**解決方案**：
- 特徵選擇（Filter, Wrapper, Embedded）
- 降維技術（PCA）
- 使用統計量而非原始值（mean, std, slope）

---

## 論文撰寫重點

### 標題（可能）
> **Diminishing Returns of Longitudinal Health Records: How Many Check-ups Are Needed for Optimal Hypertension, Hyperglycemia, and Dyslipidemia Prediction?**

### 關鍵章節
1. **Introduction**：提出邊際效應遞減的假設
2. **Methods - Experimental Design**：詳述不同記錄數的實驗設計
3. **Results**：
   - Table: 不同記錄數的性能比較
   - Figure: 準確度-記錄數曲線 + 邊際收益圖
4. **Discussion**：
   - 臨床建議（如「3 次檢驗達最佳平衡」）
   - 與 Liu et al. 對比（他們用 2 次，我們證明 3 次更好）

---

## 後續擴展

### 1. 疾病別分析
不同疾病可能有不同的邊際效應：
- 高血壓：可能 2 次記錄即飽和（變化慢）
- 高血糖：可能需要 4+ 次（變化快、波動大）
- 高血脂：可能 3 次即可

### 2. 個人化分析
某些病患可能需要更多歷史資料：
- 高風險族群（家族史、肥胖）→ 需 4+ 次
- 低風險族群（年輕、健康）→ 2-3 次即可

### 3. 時間窗口分析
固定使用 3 次記錄，但改變時間間隔：
- 每 6 個月檢查 1 次 vs. 每 2 年檢查 1 次
- 哪個時間密度最有效？

---

## 參考文獻

- 經濟學中的邊際效用理論
- Diminishing returns in machine learning: [參考論文]
- 時間序列深度對預測性能的影響: [參考論文]

---

## 會議討論紀錄

**日期**: 2025-01-14（推測）
**提出人**: 教授
**核心概念**: 邊際效應遞減
**實驗方向**: 測試 2 次、3 次、4 次...記錄數對預測準確度的影響
**研究價值**: 找到最佳的「檢驗次數-準確度」平衡點，提供臨床實務建議

---

## 標籤

`#邊際效應遞減` `#實驗設計` `#時間序列深度` `#成本效益分析` `#臨床實用性` `#特徵工程` `#縱向資料`
