# Memo 19: 統計顯著性檢驗方法

> **日期**：2025-12-30
> **主題**：5-fold CV + Paired t-test

---

## 為什麼需要統計檢驗？

當我們比較兩種方法（如 T2-Only vs T2+Δ），看到 AUC 從 0.68 提升到 0.78，要回答一個問題：

**這個提升是真的有效，還是只是偶然？**

---

## 方法一：5-fold 交叉驗證

### 原理

把資料分成 5 份，輪流用 4 份訓練、1 份測試：

```
Fold 1: [測試] [訓練] [訓練] [訓練] [訓練]
Fold 2: [訓練] [測試] [訓練] [訓練] [訓練]
Fold 3: [訓練] [訓練] [測試] [訓練] [訓練]
Fold 4: [訓練] [訓練] [訓練] [測試] [訓練]
Fold 5: [訓練] [訓練] [訓練] [訓練] [測試]
```

### 結果

每種方法得到 5 個 AUC 分數：

```
T2-Only:  [0.68, 0.69, 0.67, 0.70, 0.68]
T2+Δ:     [0.78, 0.79, 0.77, 0.80, 0.78]
```

### 優點

- 每筆資料都當過測試集，結果更穩定
- 可以計算標準差，評估變異程度
- 為統計檢驗提供多個樣本點

### 程式碼

```python
from sklearn.model_selection import StratifiedKFold, cross_val_score

cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)
auc_scores = cross_val_score(model, X, y, cv=cv, scoring='roc_auc')

print(f"AUC: {auc_scores.mean():.3f} ± {auc_scores.std():.3f}")
```

---

## 方法二：Paired t-test（配對 t 檢定）

### 為什麼用「配對」？

因為每個 fold 的兩個分數來自**同一批測試資料**：

| Fold | T2-Only | T2+Δ | 差異 |
|------|---------|------|------|
| 1 | 0.68 | 0.78 | +0.10 |
| 2 | 0.69 | 0.79 | +0.10 |
| 3 | 0.67 | 0.77 | +0.10 |
| 4 | 0.70 | 0.80 | +0.10 |
| 5 | 0.68 | 0.78 | +0.10 |

### 和普通 t-test 的差別

| 類型 | 適用情境 | 例子 |
|------|----------|------|
| **Paired t-test** | 同一組樣本，兩種條件 | 同一批資料，不同特徵集 |
| **Independent t-test** | 兩組不同樣本 | A 組病人 vs B 組病人 |

### 為什麼要配對？

可以**消除資料本身的變異**。

例如 Fold 3 的資料可能比較難預測，所以兩種方法分數都偏低。但我們關心的是「差異」，不是「絕對分數」。配對後只看差異，結果更準確。

### 程式碼

```python
from scipy import stats

# 5-fold CV 的 AUC 分數
t2_only_scores = [0.68, 0.69, 0.67, 0.70, 0.68]
t2_delta_scores = [0.78, 0.79, 0.77, 0.80, 0.78]

# Paired t-test
t_stat, p_value = stats.ttest_rel(t2_delta_scores, t2_only_scores)

print(f"t-statistic: {t_stat:.3f}")
print(f"p-value: {p_value:.6f}")
```

---

## 解讀 p-value

| p-value | 符號 | 意義 |
|---------|------|------|
| p < 0.05 | * | 差異「不太可能是偶然」 |
| p < 0.01 | ** | 差異「很不可能是偶然」 |
| p < 0.001 | *** | 差異「幾乎不可能是偶然」 |
| p ≥ 0.05 | ns | 不顯著（not significant） |

### 注意：p-value ≠ 效果大小

| 指標 | 意義 | 問的問題 |
|------|------|----------|
| **Δ 提升** | 效果大小 (Effect Size) | 「改善了多少？」 |
| **p-value** | 統計顯著性 | 「這個結果是真的嗎？」 |

實務上兩個都要看：

| 情況 | 解讀 |
|------|------|
| Δ 大 + p 小 | 真正有價值的發現 |
| Δ 小 + p 小 | 效果小但確定存在 |
| Δ 大 + p 大 | 可能是偶然，需要更多數據 |
| Δ 小 + p 大 | 沒有效果 |

---

## 本研究的實驗結果

### T2-Only vs T2+Δ（Paired t-test）

| 疾病 | 模型 | Δ 提升 | p-value | 顯著性 |
|------|------|--------|---------|--------|
| 高血壓 | LR | +0.05 | 0.00056 | *** |
| 高血壓 | XGB | +0.10 | 0.00001 | *** |
| 高血糖 | LR | +0.01 | 0.41 | ns |
| 高血糖 | XGB | +0.01 | 0.09 | ns |
| 高血脂 | LR | +0.02 | 0.0037 | ** |
| 高血脂 | XGB | +0.02 | 0.046 | * |

### 結論

- **高血壓**：Δ 特徵貢獻大（+5~10%），且高度顯著
- **高血脂**：Δ 特徵有貢獻（+2%），統計顯著
- **高血糖**：Δ 特徵貢獻小（+1%），統計不顯著

---

## 參考資料

- [scipy.stats.ttest_rel](https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.ttest_rel.html)
- [sklearn cross_val_score](https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_val_score.html)
