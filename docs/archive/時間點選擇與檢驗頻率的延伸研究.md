# 時間點選擇與檢驗頻率的延伸研究

> **建立日期**：2025-12-04
> **來源**：Meeting 17 討論
> **狀態**：未來工作

---

## 背景

我們的資料集有不同檢驗頻率的受檢者：

| 檢查次數 | 人數 | 百分比 |
|---------|------|--------|
| 3 次 | ~2,000 | ~33% |
| 4 次 | ~2,000 | ~33% |
| 5 次 | ~1,500 | ~25% |
| 6+ 次 | ~500 | ~8% |

目前做法：**只用前三次（T1, T2, T3），捨棄其他時間點**

---

## 延伸研究問題

### 問題一：改用後三次會更準嗎？

```
目前：T1, T2 → 預測 T3（前三次）
替代：T4, T5 → 預測 T6（後三次）
```

| 方案 | 優點 | 缺點 |
|------|------|------|
| **前三次** | 樣本數最多 | 預測較遠的未來 |
| **後三次** | 資料更接近現況、Δ 反映當前趨勢 | 樣本數大幅減少、存活者偏差 |

**假設**：
- 後三次可能更準：受檢者健康狀態更穩定
- 後三次可能更差：樣本減少導致過擬合

---

### 問題二：檢驗次數越多，預測越準？

**消融實驗設計**：

| 實驗 | 使用資料 | 樣本數（估計） | 預期 AUC |
|------|---------|---------------|----------|
| A | 僅 ≥3 次的人 | ~6,000 | 基準 |
| B | 僅 ≥4 次的人 | ~4,000 | ? |
| C | 僅 ≥5 次的人 | ~2,000 | ? |
| D | 僅 ≥6 次的人 | ~500 | ? |

**可能結果**：
1. **AUC 上升** → 檢驗頻率高的人更可預測（規律追蹤者）
2. **AUC 下降** → 樣本數減少導致過擬合
3. **AUC 持平** → 檢驗次數不影響預測能力

---

## 建議實驗

### 實驗 A：時間點位置比較

```python
# 前三次 vs 後三次
results_early = train_model(T1, T2, predict=T3)
results_late = train_model(T_last-2, T_last-1, predict=T_last)
compare(results_early, results_late)
```

### 實驗 B：檢驗頻率分層分析

```python
# 按檢驗次數分組，比較各組 AUC
for n in [3, 4, 5, 6]:
    subset = data[data['exam_count'] >= n]
    auc = train_and_evaluate(subset)
    print(f"≥{n}次: AUC = {auc}")
```

---

## 口述說明

> 這是一個有價值的延伸研究方向。目前我們只用前三次檢查，但有些人有 6 次以上的紀錄。
>
> 第一個問題是：用後三次會不會更準？因為資料更接近現況。
>
> 第二個問題是：檢驗次數越多的人，是否越容易預測？
>
> 這兩個問題都可以透過消融實驗來回答，可以列入未來工作。

---

## 問題三：動態時間點選擇（追蹤疾病發生點）

### 概念

不是固定用前三次，而是**根據每個人的發病時間動態調整**：

```
情境：某人有 6 次檢查，T1-T4 健康，T5 首次發病

固定策略：用 T1, T2 預測 T3（T3 健康 → Y=0）
          → 這筆資料對「預測發病」沒有貢獻

動態策略：用 T3, T4 預測 T5（T5 發病 → Y=1）
          → 捕捉「發病前」的真實特徵變化
```

### 實作邏輯

```python
def get_dynamic_timepoints(patient_data):
    """找到首次發病的時間點，往前取兩個時間點"""

    # 找到首次發病的 index
    first_disease_idx = find_first_disease(patient_data)

    if first_disease_idx is None:
        # 從未發病 → 用最後三次（作為負樣本）
        return T_last-2, T_last-1, T_last
    elif first_disease_idx >= 2:
        # T3 或之後發病 → 往前推兩個時間點
        return first_disease_idx-2, first_disease_idx-1, first_disease_idx
    else:
        # T1 或 T2 就發病 → 無法使用（排除）
        return None
```

### 策略比較

| 策略 | 說明 | 優點 | 缺點 |
|------|------|------|------|
| **固定時間點** | 統一用 T1, T2, T3 | 簡單、樣本一致 | 可能錯過最關鍵的轉變期 |
| **動態時間點** | 根據發病時間調整 | 捕捉「轉變前」的真實特徵 | 實作複雜、可能有偏差 |

### 注意事項

| 問題 | 說明 |
|------|------|
| **樣本偏差** | 晚發病的人可能本來就較健康 |
| **時間不一致** | 不同人的 Δ 可能跨越不同年份 |
| **負樣本定義** | 從未發病的人要怎麼選時間點？ |

---

## 優先級

- **當前階段**：不執行（專注於核心實驗）
- **論文撰寫**：可列入「未來工作」章節
- **有餘力時**：可作為額外實驗增加論文深度

---

**相關文件**：
- [為何用T3而非T2作為預測目標.md](為何用T3而非T2作為預測目標.md)
- [Next_Steps_Research_Plan.md](../research_plans/Next_Steps_Research_Plan.md)
