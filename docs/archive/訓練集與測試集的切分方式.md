# 訓練集與測試集的切分方式

> **建立日期**：2025-12-04
> **來源**：Meeting 17 討論
> **狀態**：核心知識（務必熟悉）

---

## 我們的切分方式

```python
X_train, X_test, y_train_multi, y_test_multi = train_test_split(
    X, y_multi,
    test_size=0.2,          # 20% 作為測試集
    random_state=42,        # 固定隨機種子，確保可重現
    stratify=y_hypertension # 分層抽樣，維持類別比例
)
```

---

## 關鍵參數說明

| 參數 | 值 | 意義 |
|------|-----|------|
| **test_size** | 0.2 | 20% 資料用於測試，80% 用於訓練 |
| **random_state** | 42 | 固定隨機種子，每次執行結果一致 |
| **stratify** | y_hypertension | 確保訓練集和測試集的疾病比例相同 |

---

## 實際數據

| 資料集 | 樣本數 | 百分比 |
|--------|--------|--------|
| **訓練集** | ~4,845 人 | 80% |
| **測試集** | ~1,211 人 | 20% |
| **總計** | ~6,056 人 | 100% |

---

## 為什麼用 80/20 比例？

這是機器學習的**標準做法**：

| 比例 | 說明 |
|------|------|
| **80/20** | 最常見，平衡訓練資料量與測試可靠性 |
| **70/30** | 測試集較大，更保守的評估 |
| **90/10** | 資料量少時使用，盡量保留訓練資料 |

我們的資料約 6,000 人，80/20 是合理選擇。

---

## 什麼是分層抽樣（Stratified Sampling）？

**問題**：如果隨機切分，可能導致訓練集和測試集的疾病比例不同

```
假設原始資料：30% 有高血壓、70% 無高血壓

❌ 純隨機切分可能產生：
   訓練集：25% 有高血壓
   測試集：40% 有高血壓
   → 評估結果會有偏差

✅ 分層抽樣確保：
   訓練集：30% 有高血壓
   測試集：30% 有高血壓
   → 比例一致，評估更可靠
```

---

## random_state=42 的意義

```python
# 每次執行都會得到相同的切分結果
train_test_split(..., random_state=42)
```

**好處**：
1. **可重現性**：任何人執行程式都會得到相同結果
2. **公平比較**：不同模型在完全相同的資料上比較
3. **除錯方便**：問題可以被重現和解決

**為什麼是 42？**：純粹是慣例（來自《乞丐聖手大漫遊》），任何數字都可以

---

## 訓練集 vs 測試集的角色

```
┌─────────────────────────────────────────────────────────┐
│                    完整資料集（6,056 人）                 │
├─────────────────────────────────┬───────────────────────┤
│      訓練集（80%，4,845 人）      │   測試集（20%，1,211 人）│
├─────────────────────────────────┼───────────────────────┤
│  • 模型學習用                    │  • 最終評估用          │
│  • 可以反覆使用                  │  • 只在最後使用一次     │
│  • 會做交叉驗證                  │  • 模擬「未見過的資料」  │
└─────────────────────────────────┴───────────────────────┘
```

---

## 我們的驗證流程

```
訓練集（4,845 人）
    │
    ├── 5-fold 交叉驗證
    │   ├── Fold 1: 80% 訓練 / 20% 驗證
    │   ├── Fold 2: 80% 訓練 / 20% 驗證
    │   ├── Fold 3: 80% 訓練 / 20% 驗證
    │   ├── Fold 4: 80% 訓練 / 20% 驗證
    │   └── Fold 5: 80% 訓練 / 20% 驗證
    │
    └── 選出最佳模型
            │
            ▼
測試集（1,211 人）── 最終評估 ── 報告 AUC
```

---

## 口述回答（教授提問時）

> 我們採用 80/20 的比例切分訓練集和測試集。
>
> 具體來說，6,056 位受檢者中，約 4,800 人用於訓練，1,200 人用於測試。
>
> 我們使用分層抽樣（stratified sampling），確保訓練集和測試集的疾病比例一致。
>
> 另外，我們固定了 random_state=42，讓實驗結果可以被重現。
>
> 在訓練集上，我們還進行了 5-fold 交叉驗證來選擇模型參數。

---

## 常見追問與回答

### Q：為什麼不用更多資料來訓練（如 90/10）？

> 20% 的測試集約 1,200 人，這個數量足以產生可靠的 AUC 估計。如果測試集太小，評估結果的變異會很大。

### Q：為什麼用 y_hypertension 來分層，而不是三個疾病都考慮？

> 高血壓是三高中最難預測的（AUC 最低），確保高血壓的比例平衡最重要。實務上，三個疾病的發病率有相關性，分層一個通常足夠。

### Q：測試集有沒有資料洩漏的問題？

> 沒有。我們在切分資料**之後**才進行特徵工程和模型訓練。測試集完全沒有參與任何訓練過程。

---

**相關文件**：
- [為何用T3而非T2作為預測目標.md](為何用T3而非T2作為預測目標.md)
- [時間點選擇與檢驗頻率的延伸研究.md](時間點選擇與檢驗頻率的延伸研究.md)
