# Netayawijit et al. (2025) Healthcare — SMOTE+SHAP 框架深度解析

> **論文**：Interpretable Machine Learning Framework for Diabetes Prediction: Integrating SMOTE Balancing with SHAP Explainability for Clinical Decision Support
> **期刊**：Healthcare (MDPI), 2025; 13(20), 2588
> **作者**：Pathamakorn Netayawijit, Wirapong Chansanam, Kanda Sorn-In
> **機構**：Khon Kaen University, Thailand
> **DOI**：[10.3390/healthcare13202588](https://doi.org/10.3390/healthcare13202588)
> **完整翻譯**：[Paper_SMOTE_SHAP_2025_Full.md](Paper_SMOTE_SHAP_2025_Full.md)

---

## 📋 基本資訊

| 項目 | 內容 |
|------|------|
| **研究主題** | 可解釋機器學習框架用於糖尿病預測 |
| **研究設計** | 回顧性橫斷面研究（概念驗證） |
| **資料來源** | Kaggle — Diabetes Prediction Dataset（公開資料集） |
| **樣本數** | 1,500 筆（從 100,000 筆隨機抽樣） |
| **類別分佈** | 糖尿病 524 人（34.9%）/ 非糖尿病 976 人（65.1%） |
| **核心方法** | SMOTE 類別平衡 + SHAP 可解釋性 |
| **比較模型** | RF、Gradient Boosting、SVM、LR、XGBoost |
| **最佳結果** | RF：Accuracy 96.91%、AUC 0.998 |
| **驗證方法** | 5-fold Stratified CV + McNemar's test |

> **與本研究的關係**：此論文為我們選擇新增 NB/LDA 傳統統計方法的來源之一。其 §2.1.1 提到早期糖尿病預測依賴「邏輯回歸、判別分析和基本風險評分系統」等傳統統計方法，我們據此挑選了實作簡單的 NB 和 LDA 加入模型比較。

---

## 🎯 研究核心

### 研究目的

開發一個整合 SMOTE 與 SHAP 的可解釋機器學習框架，同時解決兩個臨床 AI 落地障礙：
1. **類別不平衡**：真實醫療資料中，疾病陽性案例遠少於陰性
2. **可解釋性不足**：黑箱模型缺乏臨床信任度

### 三大研究缺口

| 缺口 | 說明 | 本研究對策 |
|------|------|-----------|
| 類別不平衡 | 模型偏向多數類，漏診高風險病例 | SMOTE 合成少數類樣本 |
| 缺乏可解釋性 | 黑箱模型阻礙臨床信任 | SHAP Global + Local 解釋 |
| 普遍性有限 | 小型資料集，結果難以推廣 | 子群公平性分析 |

---

## 📊 方法論亮點

### 七階段管道

```
原始資料 (n=1,500)
    ↓
① 缺失值處理（中位數/<5%、MICE/5-10%、多重填補/>10%）
    ↓
② 離群值檢測（IQR + Z-score + 臨床審查 + Winsorization）
    ↓
③ Z-score 標準化
    ↓
④ 訓練/測試分割 (80/20)
    ↓
⑤ SMOTE（僅在訓練折內，防止資料洩漏）
    ↓
⑥ Grid Search + 5-fold Stratified CV
    ↓
⑦ SHAP 可解釋性分析
```

### SMOTE 資料洩漏防護（關鍵設計）

| 步驟 | 說明 |
|------|------|
| 1 | 先分割訓練/測試集，**再** 做 SMOTE |
| 2 | SMOTE 僅在每個 CV fold 的訓練集內獨立執行 |
| 3 | 測試集保持原始分佈，不受合成樣本污染 |
| 4 | 每一折重新生成合成樣本 |

> **對我們的啟示**：我們目前的實驗已在 CV fold 內執行 SMOTE（見 Nb24），設計一致。

### 傳統統計方法的定位（§2.1.1）

論文明確將疾病預測方法分為兩個階段：

| 階段 | 方法 | 特徵 |
|------|------|------|
| **傳統統計** | 邏輯回歸、**判別分析**、風險評分系統 | 線性假設、可解釋、無法捕捉複雜交互 |
| **機器學習** | RF、GB、SVM、XGBoost | 非線性、高效能、黑箱 |

> **我們的決策依據**：從傳統統計方法中，教授建議新增 Naive Bayes 和 LDA（判別分析），與既有的 LR 組成「傳統統計方法」對照組（三種方法），與機器學習方法做對比。

---

## 📈 關鍵結果

### 模型效能比較

| 模型 | Original Acc | SMOTE Acc | Original AUC | SMOTE AUC |
|------|-------------|-----------|-------------|-----------|
| **Random Forest** | **96.91%** | **96.67%** | **0.998** | **0.997** |
| Gradient Boosting | 95.70% | 93.50% | 0.993 | 0.991 |
| SVM | 83.00% | 79.30% | 0.840 | 0.860 |
| Logistic Regression | — | — | — | — |
| XGBoost | — | — | — | — |

**重要觀察**：
- RF 效能最優且 SMOTE 前後最穩定（僅降 0.24%）
- GB 在 SMOTE 後下降 2.2%
- SVM 效能最差，SMOTE 後更差（-3.7%）
- AUC 0.998 異常高，可能是資料特性（Kaggle 資料集較簡單）

### SHAP 特徵重要性

| 排名 | 特徵 | SHAP 值 | 臨床意義 |
|------|------|---------|---------|
| 1 | Glucose | 2.34 ± 0.67 | 主要診斷指標 |
| 2 | BMI | 1.87 ± 0.43 | 肥胖風險因子 |
| 3 | Age | 1.23 ± 0.31 | 年齡風險 |
| 4 | Diabetes Pedigree | 0.89 ± 0.24 | 家族史 |

### 模型穩定性（5-fold CV）

- 平均 Accuracy：96.90 ± 0.30%
- 平均 AUC：0.998 ± 0.001
- CV（變異係數）：0.31% → 極高穩定性

### 子群公平性

- 年齡/性別/BMI 各子群差異均無統計顯著（p > 0.05）
- TPR 差異 < 2%，FPR 差異 < 1.5%

---

## 🔍 與本研究的比較

| 面向 | Netayawijit et al. (2025) | 我們的研究 |
|------|--------------------------|-----------|
| **疾病** | 糖尿病（單一） | 高血壓、高血糖、高血脂（三種） |
| **資料** | Kaggle 公開橫斷面資料 | 杭州社區 HRS 縱向三次健檢 |
| **樣本** | 1,500（抽樣自 100,000） | 6,119 |
| **陽性比例** | 34.9% | 高血壓 19.7%、高血糖 8.3%、高血脂 15.6% |
| **特徵** | 靜態特徵 | T1 + T2 + Δ 時序特徵 |
| **模型** | RF, GB, SVM, LR, XGB | LR, NB, LDA, DT, RF, XGB, SVM, MLP, PySR |
| **類別平衡** | SMOTE (1:1) | class_weight='balanced' + SMOTE 實驗 |
| **可解釋性** | SHAP Global + Local + Interaction | SHAP Global + 符號回歸公式 |
| **最佳 AUC** | 0.998 (RF) | 0.932 (LR for Hyperglycemia) |
| **驗證** | 5-fold CV + McNemar | 5-fold CV |

### 我們的優勢

1. **縱向資料**：三次健檢 + Δ 特徵，捕捉時間變化趨勢
2. **多疾病預測**：同時預測三高，而非單一疾病
3. **更多模型**：9 種模型（含傳統統計 3 種 + ML 5 種 + 符號回歸）
4. **更真實的 AUC**：0.75-0.93 範圍，反映真實臨床挑戰
5. **符號回歸**：提供數學公式，而非僅黑箱 + 事後解釋

### 可借鏡之處

1. **SMOTE 洩漏防護**：在 CV fold 內執行（我們已實施）
2. **SHAP 交互分析**：Glucose × BMI 交互效應（可考慮加入）
3. **McNemar's test**：模型效能差異的統計顯著性檢定
4. **子群公平性分析**：按年齡、性別子群評估效能一致性
5. **計算效率報告**：訓練時間、預測時間的量化比較

---

## ⚠️ 限制與批判性評估

| 問題 | 說明 |
|------|------|
| **AUC 過高** | 0.998 不太現實，可能是 Kaggle 資料過於乾淨或特徵與標籤高度相關 |
| **樣本量小** | 僅 1,500 筆（從 10 萬抽樣），代表性存疑 |
| **橫斷面設計** | 無時間維度，只能做分類、無法做預測 |
| **非真實臨床** | Kaggle 資料集非 EHR，外部效度低 |
| **自稱概念驗證** | 論文自己承認是 proof-of-concept，不可推廣 |
| **傳統方法論述薄弱** | §2.1.1 僅一句話帶過傳統統計方法，未深入討論 |

---

## 📝 論文在本研究中的引用位置

| 章節 | 用途 |
|------|------|
| Ch2 §2.5.1 | SMOTE 方法論與洩漏防護 |
| Ch3 §3.4 | 傳統統計方法（NB/LDA）選擇依據 |
| Ch3 §3.5 | 評估指標框架參考 |

---

## 🔑 一句話總結

> 本研究是一個方法學概念驗證，展示 SMOTE + SHAP 整合框架在糖尿病預測的可行性。對我們的主要貢獻是提供「傳統統計方法 vs. 機器學習」的分類框架，啟發我們新增 NB/LDA 作為傳統方法對照組。
