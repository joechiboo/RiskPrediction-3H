# 第四章 實驗結果

本章呈現各項實驗的結果，包括模型性能比較、特徵重要性分析、消融實驗以及符號回歸實驗。所有實驗皆採用滑動窗口資料集（13,514 筆紀錄）與 StratifiedGroupKFold 5-fold 交叉驗證，確保同一參與者的紀錄不會同時出現在訓練集與測試集中。

## 4.1 模型性能比較

### 4.1.1 整體結果

表 4-1 呈現六種模型在三項預測任務上的 AUC 表現。整體而言，Logistic Regression 在三項任務中皆展現穩定且優異的預測能力，尤其在高血糖預測達到最高的 AUC（0.938）。

**表 4-1 各模型 AUC 比較（5-Fold CV）**

| 模型 | 高血壓 | 高血糖 | 高血脂 |
|------|--------|--------|--------|
| LR | 0.721 ± 0.017 | **0.938 ± 0.010** | **0.867 ± 0.012** |
| DT | 0.658 ± 0.012 | 0.835 ± 0.014 | 0.744 ± 0.037 |
| RF | 0.743 ± 0.013 | 0.932 ± 0.008 | 0.859 ± 0.014 |
| XGB | 0.738 ± 0.012 | 0.930 ± 0.014 | 0.857 ± 0.016 |
| SVM | 0.726 ± 0.011 | 0.919 ± 0.012 | 0.845 ± 0.012 |
| MLP | 0.703 ± 0.033 | 0.919 ± 0.021 | 0.742 ± 0.136 |

註：粗體表示該疾病最佳結果；所有數值為 mean ± std

### 4.1.2 高血壓預測結果

高血壓預測（陽性率 16.68%）的 AUC 介於 0.658 至 0.743 之間。Random Forest 達到最高的 AUC（0.743），其次為 XGBoost（0.738）與 SVM（0.726）。Decision Tree 表現最差（0.658），而 MLP 則呈現較大的變異（標準差 0.033）。

表 4-2 呈現高血壓預測的完整評估指標。值得注意的是，RF 雖然 AUC 最高，但其 Sensitivity 僅 0.286，顯示模型傾向保守預測。相較之下，LR 與 SVM 在 Sensitivity 與 Specificity 之間取得較佳的平衡。

**表 4-2 高血壓預測詳細結果**

| 模型 | AUC | Sensitivity | Specificity | F1-Score |
|------|-----|-------------|-------------|----------|
| LR | 0.721 | 0.697 | 0.638 | 0.434 |
| DT | 0.658 | 0.646 | 0.629 | 0.404 |
| RF | **0.743** | 0.286 | 0.890 | 0.328 |
| XGB | 0.738 | 0.678 | 0.676 | 0.447 |
| SVM | 0.726 | 0.704 | 0.635 | 0.436 |
| MLP | 0.703 | 0.017 | 0.996 | 0.032 |

### 4.1.3 高血糖預測結果

高血糖預測（陽性率 5.53%）展現最佳的預測效能，所有模型的 AUC 皆高於 0.83。Logistic Regression 達到最高的 AUC（0.938），其次為 RF（0.932）與 XGBoost（0.930）。此結果顯示空腹血糖的縱向變化具有高度的預測價值。

**表 4-3 高血糖預測詳細結果**

| 模型 | AUC | Sensitivity | Specificity | F1-Score |
|------|-----|-------------|-------------|----------|
| LR | **0.938** | 0.858 | 0.882 | 0.461 |
| DT | 0.835 | 0.763 | 0.887 | 0.431 |
| RF | 0.932 | 0.551 | 0.965 | 0.525 |
| XGB | 0.930 | 0.745 | 0.933 | 0.532 |
| SVM | 0.919 | 0.721 | 0.922 | 0.488 |
| MLP | 0.919 | 0.304 | 0.988 | 0.399 |

### 4.1.4 高血脂預測結果

高血脂預測（陽性率 5.96%）的 AUC 介於 0.742 至 0.867 之間。LR 達到最高的 AUC（0.867），RF（0.859）與 XGBoost（0.857）緊隨其後。MLP 在此任務中呈現最大的不穩定性（標準差 0.136）。

**表 4-4 高血脂預測詳細結果**

| 模型 | AUC | Sensitivity | Specificity | F1-Score |
|------|-----|-------------|-------------|----------|
| LR | **0.867** | 0.799 | 0.775 | 0.362 |
| DT | 0.744 | 0.673 | 0.785 | 0.323 |
| RF | 0.859 | 0.391 | 0.942 | 0.378 |
| XGB | 0.857 | 0.676 | 0.844 | 0.388 |
| SVM | 0.845 | 0.695 | 0.821 | 0.368 |
| MLP | 0.742 | 0.066 | 0.995 | 0.108 |

### 4.1.5 模型比較小結

綜合三項預測任務的結果，可得以下觀察：

1. **Logistic Regression 表現最穩定**：在三項任務中皆達到最高或接近最高的 AUC，且 Sensitivity/Specificity 平衡良好，適合作為臨床應用的基準模型。

2. **Random Forest 與 XGBoost 表現相近**：兩者皆為強健的集成方法，但傾向保守預測（高 Specificity、低 Sensitivity）。

3. **MLP 穩定性不足**：在高血壓與高血脂任務中呈現極端的預測行為（幾乎全部預測為負類），標準差亦較大。

4. **Decision Tree 預測效能最低**：單一決策樹容易過擬合，不建議作為最終預測模型。

5. **高血糖預測效能最佳**：三項任務中，高血糖的 AUC 普遍最高，可能因 FBG 本身即為診斷指標的直接前驅。

## 4.2 特徵重要性分析

### 4.2.1 SHAP 特徵重要性

本研究使用 SHAP（SHapley Additive exPlanations）分析 XGBoost 模型的特徵重要性。表 4-5 呈現三項疾病的 Top 10 重要特徵。

**表 4-5 各疾病 Top 10 重要特徵（SHAP）**

| 排名 | 高血壓 | 高血糖 | 高血脂 |
|------|--------|--------|--------|
| 1 | SBP_Y-2 | FBG_Y-1 | TC_Y-2 |
| 2 | SBP_Y-1 | FBG_Y-2 | TC_Y-1 |
| 3 | Age | ΔTC | ΔGFR |
| 4 | ΔDBP | BMI_Y-1 | Age |
| 5 | DBP_Y-1 | BMI_Y-2 | ΔTC |
| 6 | DBP_Y-2 | ΔUA | DBP_Y-1 |
| 7 | ΔGFR | ΔGFR | ΔFBG |
| 8 | ΔSBP | ΔFBG | ΔUA |
| 9 | GFR_Y-2 | GFR_Y-2 | BMI_Y-1 |
| 10 | BMI_Y-1 | UA_Y-1 | ΔBMI |

### 4.2.2 疾病特異性特徵

從表 4-5 可觀察到明顯的疾病特異性：

1. **高血壓**：血壓相關特徵（SBP、DBP）佔據主導地位，SBP_Y-2 與 SBP_Y-1 分別為第 1、2 重要特徵。這符合臨床直覺：血壓值是預測未來高血壓的最直接指標。

2. **高血糖**：空腹血糖（FBG）為最重要預測因子，FBG_Y-1 與 FBG_Y-2 分別佔據第 1、2 位。此外，BMI 與代謝相關的 Δ 特徵（ΔTC、ΔUA）亦具重要性。

3. **高血脂**：總膽固醇（TC）為最重要特徵，TC_Y-2 與 TC_Y-1 佔據前 2 位。ΔGFR 排名第 3，顯示腎功能變化與血脂代謝有關聯。

### 4.2.3 Δ 特徵的貢獻

在 Top 10 重要特徵中，Δ 特徵的佔比如表 4-6 所示：

**表 4-6 各疾病 Top 10 中 Δ 特徵數量**

| 疾病 | Δ 特徵數量 | 佔比 |
|------|------------|------|
| 高血壓 | 3 (ΔDBP, ΔGFR, ΔSBP) | 30% |
| 高血糖 | 4 (ΔTC, ΔUA, ΔGFR, ΔFBG) | 40% |
| 高血脂 | 5 (ΔGFR, ΔTC, ΔFBG, ΔUA, ΔBMI) | 50% |

此結果顯示 Δ 特徵在三項預測任務中皆具有重要貢獻，尤其在高血脂預測中，Δ 特徵佔據 Top 10 的一半。

## 4.3 Δ 特徵消融實驗

### 4.3.1 實驗設計

為驗證 Δ 特徵的預測價值，本研究設計兩組比較框架：

1. **比較框架 1**：Full (Y-2 + Y-1 + Δ) vs No-Delta (Y-2 + Y-1)
   - 目的：在完整特徵集中移除 Δ 特徵的影響

2. **比較框架 2**：Y-1 + Δ vs Y-1 Only
   - 目的：在僅有單一時間點資料時，評估 Δ 特徵的增量價值

### 4.3.2 比較框架 1 結果

表 4-7 呈現 Full vs No-Delta 的比較結果。

**表 4-7 Full vs No-Delta 比較（LR 模型）**

| 疾病 | Full (26 特徵) | No-Delta (18 特徵) | 差異 |
|------|----------------|-------------------|------|
| 高血壓 | 0.721 | 0.721 | 0.0% |
| 高血糖 | 0.938 | 0.938 | 0.0% |
| 高血脂 | 0.867 | 0.867 | 0.0% |

當模型同時擁有 Y-2 與 Y-1 的原始數值時，移除 Δ 特徵對 AUC 幾乎沒有影響。這是因為 Δ = Y-1 − Y-2，模型可以從 Y-1 與 Y-2 自行學習到變化量資訊。

### 4.3.3 比較框架 2 結果

表 4-8 呈現 Y-1 + Δ vs Y-1 Only 的比較結果。

**表 4-8 Y-1 + Δ vs Y-1 Only 比較（LR 模型）**

| 疾病 | Y-1 + Δ (18 特徵) | Y-1 Only (10 特徵) | 提升 |
|------|-------------------|-------------------|------|
| 高血壓 | 0.721 | 0.698 | **+2.3%** |
| 高血糖 | 0.938 | 0.923 | **+1.5%** |
| 高血脂 | 0.867 | 0.846 | **+2.1%** |

當模型僅有 Y-1 資料時，加入 Δ 特徵可帶來 1.5% 至 2.3% 的 AUC 提升。這顯示 Δ 特徵能有效編碼 Y-2 的「隱含資訊」，在資料受限的情境下特別有價值。

### 4.3.4 消融實驗小結

Δ 特徵消融實驗的主要發現：

1. **資訊冗餘**：當同時有 Y-2 與 Y-1 時，Δ 特徵為冗餘資訊，因模型可自行學習變化量。

2. **資料受限情境的價值**：當僅有 Y-1 資料時，Δ 特徵可提供約 2% 的 AUC 提升，展現其實用價值。

3. **特徵壓縮效果**：Δ 特徵用 8 個變數編碼了兩個時間點的關係資訊，達到特徵壓縮的效果。

## 4.4 特徵選擇消融實驗

### 4.4.1 實驗設計

為評估精簡特徵集的可行性，本研究依據 SHAP 特徵重要性排序，測試使用 Top 5、Top 10、Top 15、Top 20 與全部 26 個特徵的預測效能。

### 4.4.2 實驗結果

表 4-9 呈現不同特徵數量下的 AUC 表現。

**表 4-9 特徵選擇消融實驗結果**

| 特徵數 | 高血壓 (LR) | 高血壓 (XGB) | 高血糖 (LR) | 高血糖 (XGB) | 高血脂 (LR) | 高血脂 (XGB) |
|--------|-------------|--------------|-------------|--------------|-------------|--------------|
| 5 | 0.752 | 0.785 | 0.933 | 0.913 | 0.868 | 0.857 |
| 10 | 0.754 | 0.784 | 0.933 | 0.911 | 0.868 | 0.854 |
| 15 | 0.755 | 0.784 | 0.932 | 0.910 | 0.867 | 0.850 |
| 20 | 0.755 | 0.786 | 0.932 | 0.917 | 0.867 | 0.855 |
| 26 | 0.754 | 0.787 | 0.932 | 0.915 | 0.867 | 0.859 |

### 4.4.3 實驗結論

特徵選擇消融實驗的主要發現：

1. **Top 5 特徵即可達到接近完整效能**：使用僅 5 個最重要特徵，LR 模型在三項任務中的 AUC 降幅皆小於 0.5%。

2. **XGBoost 對特徵數量較敏感**：高血壓預測中，XGB 使用 Top 5 的效能（0.785）略低於使用全部特徵（0.787）。

3. **臨床應用啟示**：簡化的 5 特徵模型具有實用潛力，可降低資料收集成本。

## 4.5 類別不平衡處理比較

### 4.5.1 實驗設計

由於三高疾病的陽性率介於 5.5% 至 16.7%，類別不平衡可能影響模型效能。本研究比較五種 class_weight 設定：None（無調整）、balanced（自動計算）、1:3、1:5、1:10。

### 4.5.2 實驗結果

表 4-10 呈現不同 class_weight 設定下的 AUC 與 Sensitivity。

**表 4-10 類別不平衡處理比較（LR 模型）**

| 疾病 | 指標 | None | balanced | 1:3 | 1:5 | 1:10 |
|------|------|------|----------|-----|-----|------|
| 高血壓 | AUC | 0.754 | 0.754 | 0.754 | 0.754 | 0.754 |
|  | Sens | 0.053 | 0.744 | 0.513 | 0.744 | 0.903 |
| 高血糖 | AUC | 0.933 | 0.932 | 0.934 | 0.934 | 0.933 |
|  | Sens | 0.367 | 0.854 | 0.579 | 0.690 | 0.764 |
| 高血脂 | AUC | 0.867 | 0.867 | 0.868 | 0.868 | 0.867 |
|  | Sens | 0.094 | 0.806 | 0.349 | 0.515 | 0.693 |

### 4.5.3 實驗結論

1. **AUC 不受 class_weight 影響**：不同權重設定下，AUC 變化幅度小於 0.5%。

2. **Sensitivity 顯著受影響**：未調整權重時（None），模型傾向全部預測為負類，Sensitivity 極低（0.05-0.37）。使用 balanced 權重後，Sensitivity 提升至 0.74-0.85。

3. **建議使用 balanced 權重**：在疾病篩檢應用中，高 Sensitivity 較為重要，balanced 設定可在維持 AUC 的同時大幅提升 Sensitivity。

## 4.6 符號回歸實驗

### 4.6.1 實驗設計

符號回歸使用 PySR 套件，嘗試從資料中自動發現可解釋的數學公式。實驗設定：最大複雜度 20、迭代次數 100、運算子包含 +、-、*、/、exp。

### 4.6.2 發現的公式

表 4-11 呈現各疾病的最佳符號回歸公式。

**表 4-11 符號回歸發現的公式**

| 疾病 | 公式 | AUC | 訓練時間 |
|------|------|-----|----------|
| 高血壓 | $0.130 \times \exp(SBP_{Y-2})$ | 0.745 | 20.7 分鐘 |
| 高血糖 | $0.114 \times FBG_{Y-1}$ | 0.943 | 20.6 分鐘 |
| 高血脂 | $0.043 \times \exp(TC_{Y-2})$ | 0.801 | 20.8 分鐘 |

### 4.6.3 公式解讀

1. **高血壓公式**：$0.130 \times \exp(SBP_{Y-2})$
   - 僅使用單一變數 SBP_Y-2（四年前收縮壓）
   - AUC 0.745，與 Random Forest（0.743）相近
   - 公式極為簡潔，臨床可解釋性高

2. **高血糖公式**：$0.114 \times FBG_{Y-1}$
   - 簡單的線性公式，僅使用 FBG_Y-1（兩年前空腹血糖）
   - AUC 0.943，與 LR（0.938）相當
   - 驗證了空腹血糖的高預測價值

3. **高血脂公式**：$0.043 \times \exp(TC_{Y-2})$
   - 使用 TC_Y-2（四年前總膽固醇）
   - AUC 0.801，低於 LR（0.867）
   - 較複雜的模型仍有提升空間

### 4.6.4 符號回歸小結

符號回歸實驗的主要發現：

1. **單變數公式即具預測力**：三項疾病皆可用單一變數達到可接受的 AUC（0.745-0.943）。

2. **公式符合臨床直覺**：每項疾病的最佳預測因子皆為其診斷指標的歷史值。

3. **效能與複雜模型相近**：高血糖公式（AUC 0.943）甚至超越 LR（0.938），顯示簡單公式在某些任務中可達到最佳效能。

4. **臨床應用潛力**：簡單公式易於在基層醫療單位實施，不需複雜的計算資源。

## 4.7 本章小結

本章呈現了一系列實驗結果，主要發現如下：

1. **模型效能**：Logistic Regression 在三項任務中皆表現穩定，高血糖預測效能最佳（AUC 0.938）。

2. **特徵重要性**：疾病特異性明顯，血壓相關特徵對高血壓最重要，血糖對高血糖最重要，膽固醇對高血脂最重要。Δ 特徵在 Top 10 中佔 30-50%。

3. **Δ 特徵價值**：在資料受限情境下（僅有 Y-1），Δ 特徵可提供約 2% 的 AUC 提升。

4. **特徵選擇**：Top 5 特徵即可達到接近完整效能，具有簡化模型的潛力。

5. **類別不平衡處理**：balanced class_weight 設定可在維持 AUC 的同時大幅提升 Sensitivity。

6. **符號回歸**：發現極簡的預測公式，如 $0.114 \times FBG_{Y-1}$ 對高血糖預測達 AUC 0.943，展現可解釋 AI 的潛力。
