# 第六章 實驗結果

本章呈現各項實驗的結果，包括模型性能比較、特徵重要性分析、消融實驗以及符號回歸實驗。所有實驗皆採用滑動窗口資料集（13,514 筆紀錄）與 StratifiedGroupKFold 5-fold 交叉驗證，確保同一參與者的紀錄不會同時出現在訓練集與測試集中。

## 6.1 模型性能比較

**實驗目的**：回答 Q2（模型選擇與比較）——在三高疾病預測任務中，哪些機器學習模型表現最佳？傳統統計方法與機器學習方法的性能差異為何？

### 6.1.1 整體結果

表 6-1 呈現十種模型在三項預測任務上的 AUC 表現。模型涵蓋傳統統計方法（LR、NB、LDA）、基於實例方法（KNN）、樹模型（DT、RF、XGB、LGBM）、核方法（SVM）及神經網路（MLP）。整體而言，Logistic Regression 在高血糖與高血脂預測中皆達到最高 AUC，尤其高血糖預測達 0.938；高血壓預測則以 Random Forest 表現最佳（AUC 0.743）。

**表 6-1 各模型 AUC 比較（5-Fold CV）**

| 模型 | 類型 | 高血壓 | 高血糖 | 高血脂 |
|------|------|--------|--------|--------|
| LR | 傳統統計 | 0.721 ± 0.017 | **0.938 ± 0.010** | **0.867 ± 0.012** |
| NB | 傳統統計 | 0.709 ± 0.022 | 0.917 ± 0.010 | 0.847 ± 0.015 |
| LDA | 傳統統計 | 0.720 ± 0.017 | 0.936 ± 0.011 | 0.867 ± 0.012 |
| KNN | 基於實例 | 0.630 ± 0.018 | 0.782 ± 0.020 | 0.673 ± 0.013 |
| DT | 樹模型 | 0.658 ± 0.012 | 0.835 ± 0.014 | 0.744 ± 0.037 |
| RF | 樹模型 | **0.743 ± 0.013** | 0.932 ± 0.008 | 0.859 ± 0.014 |
| XGB | 樹模型 | 0.738 ± 0.012 | 0.930 ± 0.014 | 0.857 ± 0.016 |
| LGBM | 樹模型 | 0.730 ± 0.011 | 0.926 ± 0.015 | 0.852 ± 0.011 |
| SVM | 核方法 | 0.726 ± 0.011 | 0.919 ± 0.012 | 0.845 ± 0.012 |
| MLP | 神經網路 | 0.703 ± 0.033 | 0.919 ± 0.021 | 0.742 ± 0.136 |

註：粗體表示該疾病最佳結果；所有數值為 mean ± std

圖 6-1 呈現十種模型在三項疾病預測任務上的 ROC 曲線。由圖可知，高血糖預測的 ROC 曲線整體最靠近左上角，高血脂次之，高血壓最低——與表 6-1 的 AUC 數值趨勢一致。

![](../figures/fig4-1_roc_curves.png)

**圖 6-1 各模型 ROC 曲線比較（5-Fold CV）**

### 6.1.2 高血壓預測結果

高血壓預測（陽性率 16.68%）的 AUC 介於 0.630 至 0.743 之間。Random Forest 達到最高的 AUC（0.743），其次為 XGBoost（0.738）與 LightGBM（0.730）。傳統統計方法中，LR（0.721）與 LDA（0.720）表現接近，NB 略低（0.709）。KNN 表現最差（0.630），而 MLP 則呈現較大的變異（標準差 0.033）。

表 6-2 呈現高血壓預測的完整評估指標。

**表 6-2 高血壓預測詳細結果**

| 模型 | AUC | Sensitivity | Specificity | F1-Score |
|------|-----|-------------|-------------|----------|
| LR | 0.721 | 0.697 | 0.638 | 0.434 |
| NB | 0.709 | 0.357 | 0.832 | 0.347 |
| LDA | 0.720 | 0.037 | 0.988 | 0.068 |
| KNN | 0.630 | 0.116 | 0.946 | 0.172 |
| DT | 0.658 | 0.646 | 0.629 | 0.404 |
| RF | **0.743** | 0.286 | 0.890 | 0.328 |
| XGB | 0.738 | 0.678 | 0.676 | 0.447 |
| LGBM | 0.730 | 0.601 | 0.717 | 0.432 |
| SVM | 0.726 | 0.704 | 0.635 | 0.436 |
| MLP | 0.703 | 0.017 | 0.996 | 0.032 |

### 6.1.3 高血糖預測結果

高血糖預測（陽性率 5.53%）展現最佳的預測效能，除 KNN（0.782）外，其餘模型的 AUC 皆高於 0.83。Logistic Regression 達到最高的 AUC（0.938），其次為 LDA（0.936）、RF（0.932）、XGBoost（0.930）與 LightGBM（0.926）。

**表 6-3 高血糖預測詳細結果**

| 模型 | AUC | Sensitivity | Specificity | F1-Score |
|------|-----|-------------|-------------|----------|
| LR | **0.938** | 0.858 | 0.882 | 0.461 |
| NB | 0.917 | 0.601 | 0.953 | 0.511 |
| LDA | 0.936 | 0.484 | 0.980 | 0.536 |
| KNN | 0.782 | 0.223 | 0.992 | 0.331 |
| DT | 0.835 | 0.763 | 0.887 | 0.431 |
| RF | 0.932 | 0.551 | 0.965 | 0.525 |
| XGB | 0.930 | 0.745 | 0.933 | 0.532 |
| LGBM | 0.926 | 0.646 | 0.954 | 0.542 |
| SVM | 0.919 | 0.721 | 0.922 | 0.488 |
| MLP | 0.919 | 0.304 | 0.988 | 0.399 |

### 6.1.4 高血脂預測結果

高血脂預測（陽性率 5.96%）的 AUC 介於 0.673 至 0.867 之間。LR 與 LDA 並列最高 AUC（0.867），RF（0.859）、XGBoost（0.857）與 LightGBM（0.852）緊隨其後。KNN 表現最差（0.673），而 MLP 呈現最大的不穩定性（標準差 0.136）。

**表 6-4 高血脂預測詳細結果**

| 模型 | AUC | Sensitivity | Specificity | F1-Score |
|------|-----|-------------|-------------|----------|
| LR | **0.867** | 0.799 | 0.775 | 0.362 |
| NB | 0.847 | 0.416 | 0.941 | 0.396 |
| LDA | **0.867** | 0.118 | 0.991 | 0.193 |
| KNN | 0.673 | 0.061 | 0.992 | 0.105 |
| DT | 0.744 | 0.673 | 0.785 | 0.323 |
| RF | 0.859 | 0.391 | 0.942 | 0.378 |
| XGB | 0.857 | 0.676 | 0.844 | 0.388 |
| LGBM | 0.852 | 0.561 | 0.891 | 0.397 |
| SVM | 0.845 | 0.695 | 0.821 | 0.368 |
| MLP | 0.742 | 0.066 | 0.995 | 0.108 |

## 6.2 特徵重要性分析

**實驗目的**：回答 Q4（特徵重要性分析）——哪些生物標記及其變化量對三高疾病預測最為重要？Δ 特徵在重要特徵中的佔比為何？

### 6.2.1 SHAP 特徵重要性

本研究使用 SHAP（SHapley Additive exPlanations）分析 XGBoost 模型的特徵重要性。表 6-5 呈現三項疾病的 Top 10 重要特徵。

**表 6-5 各疾病 Top 10 重要特徵（SHAP）**

| 排名 | 高血壓 | 高血糖 | 高血脂 |
|------|--------|--------|--------|
| 1 | SBP_Y-2 | FBG_Y-1 | TC_Y-2 |
| 2 | SBP_Y-1 | FBG_Y-2 | TC_Y-1 |
| 3 | Age | ΔTC | ΔeGFR |
| 4 | ΔDBP | BMI_Y-1 | Age |
| 5 | DBP_Y-1 | BMI_Y-2 | ΔTC |
| 6 | DBP_Y-2 | ΔUA | DBP_Y-1 |
| 7 | ΔeGFR | ΔeGFR | ΔFBG |
| 8 | ΔSBP | ΔFBG | ΔUA |
| 9 | eGFR_Y-2 | eGFR_Y-2 | BMI_Y-1 |
| 10 | BMI_Y-1 | UA_Y-1 | ΔBMI |

圖 6-2 以水平長條圖呈現三項疾病的 Top 10 重要特徵比較，可直觀觀察各特徵對不同疾病的相對重要程度。

![](../figures/fig4-2_shap_comparison.png)

**圖 6-2 三項疾病 SHAP 特徵重要性比較（XGBoost, Top 10）**

### 6.2.2 Δ 特徵在 Top 10 中的佔比

在 Top 10 重要特徵中，Δ 特徵的佔比如表 6-6 所示：

**表 6-6 各疾病 Top 10 中 Δ 特徵數量**

| 疾病 | Δ 特徵數量 | 佔比 |
|------|------------|------|
| 高血壓 | 3 (ΔDBP, ΔeGFR, ΔSBP) | 30% |
| 高血糖 | 4 (ΔTC, ΔUA, ΔeGFR, ΔFBG) | 40% |
| 高血脂 | 5 (ΔeGFR, ΔTC, ΔFBG, ΔUA, ΔBMI) | 50% |

圖 6-3 以高血壓為例，呈現 SHAP beeswarm 圖。每個點代表一筆樣本，橫軸為 SHAP 值（對預測的影響方向與大小），顏色代表特徵值的高低。

![](../figures/fig4-3_shap_beeswarm.png)

**圖 6-3 高血壓預測 SHAP Beeswarm 圖（XGBoost）**

## 6.3 Δ 特徵消融實驗

**實驗目的**：回答 Q1（變化量特徵的預測價值）——額外納入 Δ 特徵是否能顯著提升三高疾病的預測性能？

### 6.3.1 實驗設計

為驗證 Δ 特徵的預測價值，本研究設計兩組比較框架：

1. **比較框架 1**：Full (Y-2 + Y-1 + Δ) vs No-Delta (Y-2 + Y-1)
   - 目的：在完整特徵集中移除 Δ 特徵的影響

2. **比較框架 2**：Y-1 + Δ vs Y-1 Only
   - 目的：在僅有單一時間點資料時，評估 Δ 特徵的增量價值

### 6.3.2 比較框架 1 結果

移除 Δ 特徵後，三種疾病的 AUC 均無變化（表 6-7）。

**表 6-7 Full vs No-Delta 比較（LR 模型）**

| 疾病 | Full (26 特徵) | No-Delta (18 特徵) | 差異 |
|------|----------------|-------------------|------|
| 高血壓 | 0.721 | 0.721 | 0.0% |
| 高血糖 | 0.938 | 0.938 | 0.0% |
| 高血脂 | 0.867 | 0.867 | 0.0% |

### 6.3.3 比較框架 2 結果

當模型僅有 Y-1 資料時，加入 Δ 特徵可帶來顯著提升（表 6-8）。

**表 6-8 Y-1 + Δ vs Y-1 Only 比較（LR 模型）**

| 疾病 | Y-1 + Δ (18 特徵) | Y-1 Only (10 特徵) | 提升 |
|------|-------------------|-------------------|------|
| 高血壓 | 0.721 | 0.698 | **+2.3%** |
| 高血糖 | 0.938 | 0.923 | **+1.5%** |
| 高血脂 | 0.867 | 0.846 | **+2.1%** |

圖 6-4 以長條圖呈現 LR 與 XGBoost 兩種模型在 Full vs No-Delta 條件下的 AUC 比較。

![](../figures/fig4-4_delta_ablation.png)

**圖 6-4 Δ 特徵消融實驗結果（Full vs No-Delta）**

## 6.4 特徵選擇消融實驗

**實驗目的**：回答 Q5（模型精簡的可行性）——使用少量關鍵特徵是否能維持接近完整模型的預測性能？

### 6.4.1 實驗設計

為評估精簡特徵集的可行性，本研究依據 SHAP 特徵重要性排序，測試使用 Top 5、Top 10、Top 15、Top 20 與全部 26 個特徵的預測效能。

### 6.4.2 實驗結果

表 6-9 呈現不同特徵數量下 LR 與 XGBoost 的 AUC 表現。

**表 6-9 特徵選擇消融實驗結果**

| 特徵數 | 高血壓 (LR) | 高血壓 (XGB) | 高血糖 (LR) | 高血糖 (XGB) | 高血脂 (LR) | 高血脂 (XGB) |
|--------|-------------|--------------|-------------|--------------|-------------|--------------|
| 5 | 0.752 | 0.785 | 0.933 | 0.913 | 0.868 | 0.857 |
| 10 | 0.754 | 0.784 | 0.933 | 0.911 | 0.868 | 0.854 |
| 15 | 0.755 | 0.784 | 0.932 | 0.910 | 0.867 | 0.850 |
| 20 | 0.755 | 0.786 | 0.932 | 0.917 | 0.867 | 0.855 |
| 26 | 0.754 | 0.787 | 0.932 | 0.915 | 0.867 | 0.859 |

圖 6-5 以折線圖呈現不同特徵數量下 LR 與 XGBoost 的 AUC 變化趨勢，虛線標示全特徵 AUC 的 95% 門檻。

![](../figures/fig4-5_feature_selection.png)

**圖 6-5 特徵數量與 AUC 關係（LR vs XGBoost）**

## 6.5 類別不平衡處理比較

**實驗目的**：驗證類別不平衡處理策略的穩健性——比較 class_weight、SMOTE、ADASYN 等方法對模型效能的影響，選定最適合實務應用的方案。

### 6.5.1 實驗設計

由於三高疾病的陽性率介於 5.5% 至 16.7%，類別不平衡可能影響模型效能。本研究分兩階段進行比較：

1. **方法比較**：比較五種類別不平衡處理方法（Baseline、class_weight、SMOTE、ADASYN、RandomUnderSampler）。
2. **權重設定比較**：針對 class_weight 方法，進一步比較不同權重設定（None、balanced、1:3、1:5、1:10）。

### 6.5.2 方法比較結果

表 6-10 呈現五種類別不平衡處理方法的 AUC 與 Sensitivity 比較。

**表 6-10 類別不平衡處理方法比較（LR 模型）**

| 疾病 | 指標 | Baseline | class_weight | SMOTE | ADASYN | UnderSampling |
|------|------|----------|-------------|-------|--------|---------------|
| 高血壓 | AUC | 0.719 | 0.720 | 0.719 | 0.719 | 0.719 |
|  | Sens | 0.041 | 0.698 | 0.698 | 0.696 | 0.699 |
| 高血糖 | AUC | 0.937 | 0.937 | 0.937 | 0.936 | 0.937 |
|  | Sens | 0.335 | 0.861 | 0.852 | 0.877 | 0.864 |
| 高血脂 | AUC | 0.863 | 0.864 | 0.863 | 0.863 | 0.862 |
|  | Sens | 0.135 | 0.791 | 0.785 | 0.794 | 0.790 |

由表 6-10 可觀察到兩項關鍵發現：

1. **AUC 幾乎無差異**：五種方法的 AUC 差異均小於 0.2%，顯示類別不平衡處理策略不影響模型的整體判別能力。
2. **Sensitivity 大幅改善**：相較於 Baseline（未處理），四種處理方法皆可將 Sensitivity 從極低值（高血壓 0.041、高血糖 0.335、高血脂 0.135）提升至 0.70-0.88，改善幅度達 50-70 個百分點。此結果顯示，類別不平衡處理的核心作用並非提升模型判別力，而是調整 Sensitivity-Specificity 的權衡點，使模型不再偏向多數類別。
3. **方法間差異極小**：class_weight、SMOTE、ADASYN 與 RandomUnderSampler 四種方法的 Sensitivity 差異 < 2%，而 class_weight 不需生成合成樣本、不改變資料分佈，為最簡便的實務選擇。

### 6.5.3 權重設定比較結果

表 6-11 呈現不同 class_weight 設定的比較結果。

**表 6-11 不同 class_weight 設定比較（LR 模型）**

| 疾病 | 指標 | None | balanced | 1:3 | 1:5 | 1:10 |
|------|------|------|----------|-----|-----|------|
| 高血壓 | AUC | 0.754 | 0.754 | 0.754 | 0.754 | 0.754 |
|  | Sens | 0.053 | 0.744 | 0.513 | 0.744 | 0.903 |
| 高血糖 | AUC | 0.933 | 0.932 | 0.934 | 0.934 | 0.933 |
|  | Sens | 0.367 | 0.854 | 0.579 | 0.690 | 0.764 |
| 高血脂 | AUC | 0.867 | 0.867 | 0.868 | 0.868 | 0.867 |
|  | Sens | 0.094 | 0.806 | 0.349 | 0.515 | 0.693 |

圖 6-6 以散佈圖呈現不同 class_weight 設定下 Sensitivity 與 Specificity 的權衡關係。

![](../figures/fig4-6_class_weight_tradeoff.png)

**圖 6-6 不同 class_weight 設定下的 Sensitivity-Specificity 權衡（LR 模型）**

由表 6-11 與圖 6-6 可見，不同 class_weight 設定呈現清晰的 Sensitivity-Specificity 權衡：從 None 到 1:10，Sensitivity 逐步上升而 Specificity 下降，AUC 則維持不變（差異 < 0.2%）。balanced 設定在三種疾病中皆取得 Sensitivity 0.74-0.85 的水準，同時維持合理的 Specificity，適合疾病篩檢應用場景。

### 6.5.4 實驗結論

1. **類別不平衡處理不改變模型判別力**：無論是否處理，AUC 差異均 < 0.2%，但未處理時 Sensitivity 極低（0.04-0.34），不具臨床實用性。
2. **處理方法間無顯著差異**：class_weight、SMOTE、ADASYN、RandomUnderSampler 效果等同（差異 < 2%）。
3. **class_weight='balanced' 為最佳實務選擇**：實作簡便、無需生成合成樣本、不改變資料分佈，Sensitivity 可提升至 0.74-0.85。

## 6.6 資料篩選策略比較

**實驗目的**：驗證資料處理策略的穩健性——排除基線已確診個案是否影響預測效能？確保主要實驗結果不受資料篩選方式左右。

### 6.6.1 實驗設計

資料集中部分滑動窗口樣本的起點（Y-2）已有目標疾病，這些「非新發」個案是否應該排除？本研究設計三組比較策略：

- **策略 A（目前做法）**：包含所有滑動窗口樣本（13,514 筆）。
- **策略 B**：排除首次健檢（Times=1）已確診的個案。
- **策略 C**：排除每個滑動窗口中，Y-2 已有目標疾病的樣本。

診斷閾值依據 Luo et al. (2024)：高血壓 SBP ≥ 140 或 DBP ≥ 90 mmHg、高血糖 FBG ≥ 7.0 mmol/L、高血脂 TC ≥ 6.22 mmol/L。由於原始資料集在首次健檢（Times=1）時疾病率幾乎為 0%（Luo et al. 2024 已隱含基線健康篩選），策略 B 與策略 A 實質上無差異，因此本實驗聚焦於比較策略 A 與策略 C。

### 6.6.2 排除統計

表 6-12 呈現各疾病在策略 C 下的排除統計（原始樣本數皆為 13,514 筆）。

**表 6-12 策略 C 排除統計**

| 疾病 | Y-2 已確診 | 排除後樣本數 | 原始陽性率 | 排除後陽性率 |
|------|---------------|-------------|-----------|-------------|
| 高血壓 | 1,402 (10.4%) | 12,112 | 19.3% | 17.9% |
| 高血糖 | 367 (2.7%) | 13,147 | 5.9% | 4.6% |
| 高血脂 | 548 (4.1%) | 12,966 | 7.9% | 6.8% |

### 6.6.3 實驗結果

**表 6-13 排除策略 AUC 比較（5-Fold CV）**

| 疾病 | 模型 | A（全部樣本） | C（排除已確診） | 差異 |
|------|------|-------------|---------------|------|
| 高血壓 | LR | 0.712 ± 0.015 | 0.710 ± 0.011 | -0.3% |
| 高血壓 | RF | 0.735 ± 0.012 | 0.748 ± 0.014 | +1.3% |
| 高血糖 | LR | 0.922 ± 0.017 | 0.910 ± 0.018 | -1.1% |
| 高血糖 | RF | 0.924 ± 0.011 | 0.917 ± 0.014 | -0.8% |
| 高血脂 | LR | 0.858 ± 0.012 | 0.854 ± 0.011 | -0.4% |
| 高血脂 | RF | 0.851 ± 0.017 | 0.844 ± 0.012 | -0.6% |

## 6.7 健檢次數與預測效能

**實驗目的**：回答 Q6（健檢次數對預測性能的影響）——累積更多次健檢紀錄是否能提升預測準確度？

### 6.7.1 實驗設計

為探討縱向健檢資料的累積效益，本研究設計健檢次數比較實驗。固定以預測年（Y）作為預測目標，逐步增加輸入的歷史健檢次數：1 次（僅 Y-1）、2 次（Y-2、Y-1）、3 次（Y-3～Y-1）、4 次（Y-4～Y-1），比較不同健檢次數下 LR 模型的 AUC 表現。為確保公平比較，四組實驗使用相同的 2,526 名參與者（即具有完整 5 次健檢紀錄者）。

### 6.7.2 實驗結果

圖 6-7 呈現不同健檢次數下三項疾病的 AUC 比較。

![](../figures/fig4-7_checkup_frequency.png)

**圖 6-7 健檢次數與預測準確度（LR 模型，固定預測 Y）**

## 6.8 多任務學習與單任務學習比較

**實驗目的**：回答 Q3（多任務學習的效果）——同時預測三高疾病是否優於分別預測單一疾病？

### 6.8.1 實驗設計

本研究的三項預測目標（高血壓、高血糖、高血脂）皆來自相同的健檢資料與特徵集，適合以多任務學習（Multi-Task Learning, MTL）架構同時預測。為評估 MTL 是否優於獨立訓練三個模型的單任務學習（Single-Task Learning, STL），本研究設計以下比較實驗：

- **MTL 架構**：共享底層神經網路（64 → 32 節點），頂部設置三個獨立輸出頭，分別對應三項疾病。損失函數為三項任務的加權平均。
- **STL 架構**：針對每項疾病各自訓練一個獨立的 MLP 模型，網路結構與 MTL 的單任務路徑相同（64 → 32 → 1）。

兩組實驗使用相同的滑動窗口資料集與 StratifiedGroupKFold 5-fold 交叉驗證。

### 6.8.2 實驗結果

表 6-14 呈現 MTL 與 STL 在三項疾病的 AUC 比較。

**表 6-14 MTL vs STL 比較（MLP 模型）**

| 疾病 | MTL | STL | 差異 |
|------|-----|-----|------|
| 高血壓 | 0.734 ± 0.020 | 0.742 ± 0.020 | -0.8% |
| 高血糖 | 0.932 ± 0.007 | 0.933 ± 0.007 | -0.1% |
| 高血脂 | 0.868 ± 0.009 | 0.869 ± 0.010 | -0.1% |
| **平均** | **0.845** | **0.848** | **-0.3%** |

## 6.9 符號回歸實驗

**實驗目的**：探索可解釋的數學公式——能否從資料中發現簡潔的預測公式，兼顧預測效能與臨床可解釋性？

### 6.9.1 實驗設計

符號回歸使用 PySR 套件，嘗試從資料中自動發現可解釋的數學公式。實驗設定：最大複雜度 20、迭代次數 100、運算子包含 +、-、*、/、exp。

### 6.9.2 發現的公式

表 6-15 呈現各疾病的最佳符號回歸公式。

**表 6-15 符號回歸發現的公式**

| 疾病 | 公式 | AUC | 訓練時間 |
|------|------|-----|----------|
| 高血壓 | $0.130 \times \exp(SBP_{Y-2})$ | 0.745 | 20.7 分鐘 |
| 高血糖 | $0.114 \times FBG_{Y-1}$ | 0.943 | 20.6 分鐘 |
| 高血脂 | $0.043 \times \exp(TC_{Y-2})$ | 0.801 | 20.8 分鐘 |

---

撰寫狀態：章節重組完成
最後更新：2026-02-24
維護者：紀伯喬
