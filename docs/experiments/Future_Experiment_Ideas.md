# 未來實驗構想

**建立日期**: 2025-11-24
**狀態**: 規劃中
**優先級**: 中高

---

## 💡 實驗構想 1: 時間點選擇策略對模型性能的影響

### 研究問題
**如果選擇後三次檢驗記錄（而非前三次），模型性能是否會提升？**

### 研究動機
目前策略：對於有多次檢驗的受檢者，我們只取**前三次**檢驗結果
- **假設**: 前期檢驗較可能正常，適合測試早期風險預測能力
- **問題**: 可能導致類別極度不平衡（正常個案過多）

### 實驗假設
選擇**後三次**檢驗記錄可能有以下優勢：
1. **資料更平衡**: 後期檢驗更可能出現疾病，正負樣本比例較均衡
2. **AUC 提升**: 較平衡的資料有助於模型學習特徵
3. **更豐富的病例**: 能觀察到更多疾病發展軌跡

### 實驗設計

#### 對比組設定
| 組別 | 時間點選擇策略 | 說明 |
|------|--------------|------|
| **Group A (現行)** | 前三次 (1st, 2nd, 3rd) | T1, T2, T3 = 第1、2、3次檢驗 |
| **Group B (新)** | 後三次 (N-2, N-1, N) | T1, T2, T3 = 倒數第3、2、1次檢驗 |
| **Group C (中)** | 中段三次 | T1, T2, T3 = 中間段的三次檢驗 |

#### 評估指標
- **AUC-ROC**: 主要性能指標
- **Precision/Recall**: 類別不平衡下的表現
- **F1-Score**: 綜合評估
- **類別分佈**: Positive/Negative ratio

#### 預期樣本數變化
```
假設有 N 次檢驗的受檢者分佈：
- 3次: 1,754人 → 前三次 = 後三次
- 4次: 1,776人 → 前三次 (1,2,3) vs 後三次 (2,3,4)
- 5次: 1,935人 → 前三次 (1,2,3) vs 後三次 (3,4,5)
- 6次: 556人 → 前三次 (1,2,3) vs 後三次 (4,5,6)
- 7次: 31人 → 前三次 (1,2,3) vs 後三次 (5,6,7)
- 8次: 4人 → 前三次 (1,2,3) vs 後三次 (6,7,8)
```

### 實驗步驟
1. **資料重新處理**
   - 修改 `select_three_timepoints()` 函數
   - 支援 `strategy='first'` 或 `strategy='last'` 參數

2. **特徵工程**
   - 重新計算 Δ 特徵（後三次的變化量）
   - 確保特徵定義一致

3. **模型訓練**
   - 使用相同的模型架構（LR, RF, XGBoost, ANN 等）
   - 相同的超參數設定
   - 確保公平比較

4. **性能比較**
   - AUC-ROC 比較
   - 類別分佈統計
   - 混淆矩陣分析

### 預期結果
- **假設 1**: Group B (後三次) 的 AUC 可能較高（資料更平衡）
- **假設 2**: Group B 的 Recall 可能較高（捕捉到更多病例）
- **假設 3**: Group A (前三次) 可能更適合**早期預警**應用場景

### 臨床意義
- **前三次策略**: 適合早期預警系統，預測尚未發病的高風險個體
- **後三次策略**: 適合疾病進程研究，理解發病前的軌跡變化

---

## 💡 實驗構想 2: 檢驗次數對模型性能的影響

### 研究問題
**檢驗次數越多（如 8 次），模型的預測性能是否越好？**

### 研究動機
目前策略：統一使用**三個時間點**（T1, T2, T3）
- **優勢**: 樣本大小一致，公平比較
- **問題**: 可能浪費了多次檢驗者的豐富資訊

### 實驗假設
增加時間點數量可能帶來以下好處：
1. **更豐富的縱向資訊**: 能捕捉更長期的健康變化趨勢
2. **更多 Δ 特徵**: 可計算多個時間段的變化量
3. **更準確的預測**: 更多歷史資料有助於預測未來風險

### 實驗設計

#### 分層實驗設計
按檢驗次數分組，比較不同組別的模型性能

| 組別 | 檢驗次數 | 樣本數 | 特徵設計 | 說明 |
|------|---------|--------|---------|------|
| **Group 1** | 3次 | 1,754 | T1, T2 → T3 | 基準組 |
| **Group 2** | 4次 | 1,776 | T1, T2, T3 → T4 | 增加1個時間點 |
| **Group 3** | 5次 | 1,935 | T1, T2, T3, T4 → T5 | 增加2個時間點 |
| **Group 4** | 6次 | 556 | T1~T5 → T6 | 增加3個時間點 |
| **Group 5** | 7-8次 | 35 | T1~T6+ → T(N) | 樣本數太少，可合併 |

#### 特徵工程策略

**策略 A: 增量式特徵**
```
3次: [T1 特徵, T2 特徵, Δ(T2-T1)]
4次: [T1 特徵, T2 特徵, T3 特徵, Δ(T2-T1), Δ(T3-T2), Δ(T3-T1)]
5次: [T1~T4 特徵, Δ(T2-T1), Δ(T3-T2), Δ(T4-T3), Δ(T4-T1)]
```

**策略 B: 統計聚合特徵**
```
計算歷史時間點的統計量：
- 平均值 (Mean)
- 標準差 (Std)
- 最小/最大值 (Min/Max)
- 線性趨勢 (Trend slope)
```

**策略 C: 時間序列模型**
```
使用 LSTM/GRU 等時間序列模型
輸入: 可變長度的序列
輸出: T(N) 的疾病風險
```

#### 評估指標
- **AUC-ROC**: 主要性能指標
- **特徵重要性**: 新增時間點的貢獻度
- **模型複雜度**: 訓練時間、參數數量
- **樣本效率**: 性能提升 vs 樣本數減少的權衡

### 實驗步驟

#### Phase 1: 相同特徵維度比較
1. 統一使用前三次檢驗
2. 比較不同檢驗次數組別的 AUC
3. **目的**: 驗證檢驗次數本身是否影響預測難度

#### Phase 2: 增量特徵比較
1. 根據檢驗次數調整特徵數量
2. 訓練並比較各組模型
3. **目的**: 驗證更多時間點是否提升性能

#### Phase 3: 時間序列模型
1. 實作 LSTM/GRU 模型
2. 支援可變長度輸入
3. **目的**: 充分利用所有可用時間點

### 預期結果

#### 假設 1: 檢驗次數越多，AUC 越高
```
預期趨勢:
3次: AUC = 0.75
4次: AUC = 0.77 (+0.02)
5次: AUC = 0.79 (+0.02)
6次: AUC = 0.80 (+0.01, 邊際效應遞減)
```

#### 假設 2: 樣本數減少的權衡
```
權衡分析:
- 5次組 (1,935人, AUC 0.79) vs 3次組 (1,754人, AUC 0.75)
- 性能提升 5.3%, 但樣本數充足
- 6次組 (556人) 樣本數較少，可能過擬合
```

#### 假設 3: 特徵重要性變化
- 早期時間點（T1）的重要性可能降低
- 近期變化量（Δ最新）的重要性可能更高
- 長期趨勢（Trend）可能成為新的重要特徵

### 挑戰與風險

#### 1. 樣本數不平衡
- 3次: 1,754人 vs 6次: 556人
- 較少樣本的組別可能不可靠
- **解決方案**: 重點比較 3-5 次組（樣本數充足）

#### 2. 特徵維度不一致
- 不同組別特徵數量不同
- 難以公平比較
- **解決方案**: 使用統計聚合特徵，保持維度一致

#### 3. 時間間隔不均
- 不同受檢者的檢驗時間間隔不同
- 可能影響 Δ 特徵的意義
- **解決方案**: 加入時間間隔作為額外特徵

---

## 📊 實驗優先級建議

### 優先級排序

| 實驗 | 優先級 | 難度 | 預期影響 | 建議時程 |
|------|--------|------|---------|---------|
| **實驗 1: 前 vs 後三次** | ⭐⭐⭐⭐⭐ | 低 | 高 | 1-2 週 |
| **實驗 2: 檢驗次數影響 (Phase 1)** | ⭐⭐⭐⭐ | 中 | 中高 | 2-3 週 |
| **實驗 2: 增量特徵 (Phase 2)** | ⭐⭐⭐ | 中高 | 中 | 3-4 週 |
| **實驗 2: 時間序列模型 (Phase 3)** | ⭐⭐ | 高 | 未知 | 4-6 週 |

### 推薦執行順序

#### Step 1: 實驗 1 (前 vs 後三次)
- **理由**: 實作簡單，只需修改資料選取邏輯
- **快速驗證**: 2-3 天可完成初步結果
- **高價值**: 直接影響資料策略選擇

#### Step 2: 實驗 2 Phase 1 (相同特徵維度)
- **理由**: 在實驗 1 的基礎上延伸
- **科學價值**: 驗證檢驗次數本身的影響
- **論文貢獻**: 可作為一個獨立的研究發現

#### Step 3: 實驗 2 Phase 2 (增量特徵)
- **理由**: 需要重新設計特徵工程
- **技術挑戰**: 特徵維度不一致的處理
- **潛在收益**: 可能大幅提升性能

#### Step 4: 實驗 2 Phase 3 (時間序列模型)
- **理由**: 需要學習新的模型架構
- **研究深度**: 適合作為未來研究方向
- **論文擴展**: 可獨立發表或作為後續研究

---

## 📝 實驗記錄模板

### 實驗 1: 前 vs 後三次

**執行日期**: _______
**負責人**: 紀伯喬

#### 資料統計
| 策略 | 樣本數 | 高血壓+ | 高血糖+ | 高血脂+ | 備註 |
|------|--------|---------|---------|---------|------|
| 前三次 | 6,056 | 1,010 (16.7%) | 335 (5.5%) | 361 (6.0%) | 現行 |
| 後三次 | 6,056 | ? | ? | ? | 待測量 |

#### 模型性能比較
| 模型 | 策略 | AUC (高血壓) | AUC (高血糖) | AUC (高血脂) |
|------|------|--------------|--------------|--------------|
| LR | 前三次 | 0.xxx | 0.xxx | 0.xxx |
| LR | 後三次 | 0.xxx | 0.xxx | 0.xxx |
| RF | 前三次 | 0.xxx | 0.xxx | 0.xxx |
| RF | 後三次 | 0.xxx | 0.xxx | 0.xxx |
| XGBoost | 前三次 | 0.xxx | 0.xxx | 0.xxx |
| XGBoost | 後三次 | 0.xxx | 0.xxx | 0.xxx |

#### 結論
- [ ] 後三次策略 AUC 更高
- [ ] 前三次策略 AUC 更高
- [ ] 兩者差異不顯著
- [ ] 建議策略: _______

---

### 實驗 2: 檢驗次數影響

**執行日期**: _______
**負責人**: 紀伯喬

#### Phase 1 結果 (相同特徵維度)
| 檢驗次數 | 樣本數 | AUC (高血壓) | AUC (高血糖) | AUC (高血脂) |
|---------|--------|--------------|--------------|--------------|
| 3次 | 1,754 | 0.xxx | 0.xxx | 0.xxx |
| 4次 | 1,776 | 0.xxx | 0.xxx | 0.xxx |
| 5次 | 1,935 | 0.xxx | 0.xxx | 0.xxx |
| 6次 | 556 | 0.xxx | 0.xxx | 0.xxx |

#### Phase 2 結果 (增量特徵)
| 檢驗次數 | 特徵數 | AUC (高血壓) | AUC (高血糖) | AUC (高血脂) |
|---------|--------|--------------|--------------|--------------|
| 3次 | 26 | 0.xxx | 0.xxx | 0.xxx |
| 4次 | 38 | 0.xxx | 0.xxx | 0.xxx |
| 5次 | 50 | 0.xxx | 0.xxx | 0.xxx |

#### 結論
- [ ] 檢驗次數越多，AUC 越高
- [ ] 邊際效應遞減
- [ ] 樣本數減少的影響大於性能提升
- [ ] 建議最佳檢驗次數: _______

---

## 🔬 相關文獻

### 類似研究
1. **縱向資料時間點選擇**
   - 待補充相關論文

2. **時間序列長度對預測性能的影響**
   - 待補充相關論文

3. **類別不平衡與時間點選擇**
   - 待補充相關論文

---

## 📌 行動項目

- [ ] 與指導教授討論實驗 1 的可行性
- [ ] 實作資料選取策略的靈活切換
- [ ] 準備實驗 1 的執行腳本
- [ ] 設計實驗結果的視覺化方式
- [ ] 搜尋相關文獻支持

---

**最後更新**: 2025-11-24
**下次檢視**: Meeting 17 後